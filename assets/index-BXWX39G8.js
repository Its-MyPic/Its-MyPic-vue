var De=Object.defineProperty;var _e=(a,t,e)=>t in a?De(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var K=(a,t,e)=>_e(a,typeof t!="symbol"?t+"":t,e);import{r as y,d as $,k as F,D as O,B as I,G as Q,W as o,C as r,a4 as U,a6 as k,l as de,A as _,u as h,a7 as ee,_ as A,a as $e,f as X,w as ae,L as me,a1 as Me,y as Fe,F as pe,I as fe,a8 as Ae,a9 as Re,aa as Te,X as Ee,ab as Oe}from"./@vue-WVfTJAwV.js";import{e as L,f as j,g as Ge,h as ge,i as te,j as W,k as D,l as oe,u as Pe,n as ve,o as N,p as B,q as Be,r as je,s as Y,t as P,v as z,w as le,x as ze,y as we,z as Le,A as re,B as Ne,C as qe,D as Ye}from"./vuetify-0y6YotYw.js";import{m as G,a as se,b as Je,c as Qe,d as We}from"./@mdi-DKC2W5MC.js";import{u as He,a as ye,b as he,S as R,n as Ze,c as J,F as be,M as Ke,E as ie}from"./app-CXGYcFQ0.js";import{d as xe,s as Xe}from"./pinia-4GZGaGcy.js";import{f as et,F as tt}from"./@ffmpeg-B1ncfXmI.js";import{G as at}from"./vue-virtual-scroll-grid-BzIoNprJ.js";import"./vite-ssg-CaviuLAv.js";import"./@unhead-DQR5zzVu.js";import"./unhead-NLvR5cop.js";import"./hookable-B8xFkYCm.js";import"./vue-router-DxF8NQ87.js";import"./protobufjs-CgPuVhCO.js";import"./@protobufjs-f4nnaicZ.js";import"./opencc-js-kMbEc8rw.js";const q=xe("ui",()=>{const a=y(!1),t=y(!1),e=y(!1);return{isReversed:a,copyMode:t,wayBackMode:e,toggleReverse:()=>{a.value=!a.value},toggleCopyMode:()=>{t.value=!t.value},togglewayBackMode:()=>{e.value=!e.value}}});class ue{constructor(t){K(this,"cache");K(this,"capacity");if(t<=0)throw new Error("Cache capacity must be greater than 0");this.cache=new Map,this.capacity=t}has(t){return this.cache.has(t)}get(t){const e=this.cache.get(t);if(e)return this.cache.delete(t),this.cache.set(t,e),e}set(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.capacity){const l=this.cache.keys().next();l.done||this.cache.delete(l.value)}this.cache.set(t,e)}clear(){this.cache.clear()}get size(){return this.cache.size}get maxSize(){return this.capacity}keys(){return this.cache.keys()}values(){return this.cache.values()}entries(){return this.cache.entries()}}const ot=xe("results",()=>{const a=He(),t=ye(),e=he(),l=q(),u=new ue(50),c=new ue(50),p=i=>{const d=Array.from(i.mygo).sort().join(","),n=Array.from(i.avemujica).sort().join(",");return`mygo:${d}|avemujica:${n}`},f=i=>{for(const d of i)d.text&&!d.normalizedText&&(d.normalizedText=Ze(d.text));return i};return{filteredCards:$(()=>{const i=a.cards;if(!i.length)return[];const d=f([...i]),n=t.activeFilters,v=p(n);let g;if(u.has(v)?g=u.get(v):(g=d.filter(s=>n.mygo.size&&s.season===R.MYGO?n.mygo.has(s.episode):n.avemujica.size&&s.season===R.AVE_MUJICA?n.avemujica.has(s.episode):n.mygo.size===0&&n.avemujica.size===0),u.set(v,g)),e.normalizedQuery){const s=`${v}:search:${e.normalizedQuery}`;if(c.has(s))g=c.get(s);else{const C=g.filter(S=>{var b;return(b=S.normalizedText)==null?void 0:b.includes(e.normalizedQuery)});c.set(s,C),g=C}}return l.isReversed?[...g].reverse():g})}}),nt="MTMzNTEwMzQ1NzY4MTczNTc2MC9LT0lwZ2FDc3RmRURnVHVqR2dEYmVYWWZSLUdZRjVQQ29veXZ0TFVGbFhFM0tYdGRGTzhHR3RrTXptWEp4R3FxQVI5bw==",lt={MyGO:{1:"https://www.youtube.com/watch?v=WOrYBIYIwyk",2:"https://www.youtube.com/watch?v=WOrYBIYIwyk",3:"https://www.youtube.com/watch?v=WOrYBIYIwyk",4:"https://www.youtube.com/watch?v=ijdspfPMzYc",5:"https://www.youtube.com/watch?v=zfA0zRAkAdk",6:"https://www.youtube.com/watch?v=UwgyEoB9vU8",7:"https://www.youtube.com/watch?v=rlY2b3TIYPs",8:"https://www.youtube.com/watch?v=mfboDpl88QY",9:"https://www.youtube.com/watch?v=ySjYENzyZmY",10:"https://www.youtube.com/watch?v=bLWDIYpGcEI",11:"https://www.youtube.com/watch?v=gAFDVnhX24o",12:"https://www.youtube.com/watch?v=wei3payuSi8",13:"https://www.youtube.com/watch?v=uQ3_PvPCNnI"},"Ave Mujica":{1:"https://www.youtube.com/watch?v=dxmmSFQxWzM",2:"https://www.youtube.com/watch?v=Bzl61esi4qc",3:"https://www.youtube.com/watch?v=HagaJboujK4",4:"https://www.youtube.com/watch?v=Z6cOxtDsfNU",5:"https://www.youtube.com/watch?v=7D2uGv7aprQ",6:"https://www.youtube.com/watch?v=jQraN1emvLQ",7:"https://www.youtube.com/watch?v=RONGNWb7OpQ",8:"https://www.youtube.com/watch?v=uh9jUhVTS28",9:"https://www.youtube.com/watch?v=pGrI6hk0vBg",10:"https://www.youtube.com/watch?v=m9cjOcCKIyQ",11:"https://www.youtube.com/watch?v=Cfm8TWGkvYQ",12:"https://www.youtube.com/watch?v=UtSEFdDZZLw",13:"https://www.youtube.com/watch?v=3LLj3fTpRoM"}},H={webhook:nt,videoLink:lt},ke=F({__name:"ReportDialog",props:{fileName:{type:String,required:!1,default:""},text:{type:String,required:!1,default:""}},setup(a){const t=a,e=y(""),l=y(""),u=y(!1),c=y(!1);async function p(){let f="";if(e.value&&(f+=`問題: ${e.value}
`),l.value&&(f+=`聯絡方式: ${l.value}
`),t.fileName&&(f+=`檔案名稱: ${t.fileName}
`),t.text&&(f+=`文字: ${t.text}
`),f){const m={content:f};await fetch(`https://discord.com/api/webhooks/${atob(H.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),u.value=!0}c.value=!1}return(f,m)=>(I(),O(Q,null,[o(L,{modelValue:c.value,"onUpdate:modelValue":m[2]||(m[2]=i=>c.value=i),activator:"parent","max-width":"600px",style:{maxHeight:"90vh"},transition:"dialog-bottom-transition"},{default:r(()=>[o(j,null,{default:r(()=>[o(Ge,null,{default:r(()=>m[4]||(m[4]=[U("回報問題")])),_:1}),o(ge,null,{default:r(()=>[o(te,{label:"你遭遇到的問題(選填)",modelValue:e.value,"onUpdate:modelValue":m[0]||(m[0]=i=>e.value=i),outlined:""},null,8,["modelValue"]),o(te,{label:"你的聯絡方式(選填)",modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=i=>l.value=i),outlined:""},null,8,["modelValue"])]),_:1}),o(W,null,{default:r(()=>[o(D,{onClick:p},{default:r(()=>m[5]||(m[5]=[U("送出")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(oe,{modelValue:u.value,"onUpdate:modelValue":m[3]||(m[3]=i=>u.value=i),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>m[6]||(m[6]=[k("div",{class:"text-h6 mx-auto font-weight-bold text-center text-truncate"}," 已回報問題 ",-1)])),_:1},8,["modelValue"])],64))}}),rt={key:0,class:"ml-2 d-flex align-center"},st=F({__name:"FooterComponent",setup(a){const t=q(),e=y(!0),l=$({get(){return c.global.current.value.dark},set(d){p(d)}}),u=$({get(){return t.copyMode},set(d){t.copyMode=d,localStorage.setItem("copyURLMode",d.toString())}}),c=Pe();function p(d){c.global.name.value=d?"dark":"light",localStorage.setItem("darkTheme",c.global.name.value)}const f=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("firefox"),m=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("mobile"),i=()=>!(f()&&m());return de(()=>{e.value=i(),e.value?localStorage.getItem("copyURLMode")?t.copyMode=localStorage.getItem("copyURLMode")==="true":t.copyMode=!1:t.copyMode=!0,localStorage.getItem("darkTheme")?c.global.name.value=localStorage.getItem("darkTheme")??"dark":window.matchMedia("(prefers-color-scheme: light)").matches&&(c.global.name.value="light")}),(d,n)=>{const v=ke;return I(),_(ze,{app:""},{default:r(()=>[o(ve,{fluid:"",style:{padding:"5px"}},{default:r(()=>[o(N,null,{default:r(()=>[o(B,null,{default:r(()=>[o(D,{variant:"text",size:"small",class:"text-center"},{default:r(()=>[n[7]||(n[7]=U(" 其他連結 ")),o(Be,{activator:"parent",location:"center"},{default:r(()=>[o(je,null,{default:r(()=>[o(Y,{icon:`mdiSvg:${h(G)}`},null,8,["icon"]),(I(),_(P,{key:0,target:"_blank",value:0,"append-icon":h(G),href:"https://github.com/NightFeather0615/Its-MyPic-Android"},{default:r(()=>[o(z,null,{default:r(()=>n[2]||(n[2]=[U("Its-MyPic for Android")])),_:1})]),_:1},8,["append-icon"])),(I(),_(P,{key:1,target:"_blank",value:1,"append-icon":h(G),href:"https://github.com/Its-MyPic/PowerToys-Run-Its-MyPic"},{default:r(()=>[o(z,null,{default:r(()=>n[3]||(n[3]=[U("PowerToys-Run Plugin")])),_:1})]),_:1},8,["append-icon"])),(I(),_(P,{key:2,target:"_blank",value:2,"append-icon":h(G),href:"https://github.com/Its-MyPic/krunner-Its-MyPic"},{default:r(()=>[o(z,null,{default:r(()=>n[4]||(n[4]=[U("Krunner Plugin")])),_:1})]),_:1},8,["append-icon"])),(I(),_(P,{key:3,target:"_blank",value:3,"append-icon":h(G),href:"https://github.com/Its-MyPic/Its-MyPic-vue"},{default:r(()=>[o(z,null,{default:r(()=>n[5]||(n[5]=[U("這個網頁的原始碼")])),_:1})]),_:1},8,["append-icon"])),(I(),_(P,{key:4,target:"_blank",value:4,"append-icon":h(G),href:"https://github.com/Its-MyPic/Its-MyPicDB"},{default:r(()=>[o(z,null,{default:r(()=>n[6]||(n[6]=[U("mygo系列的截圖資料")])),_:1})]),_:1},8,["append-icon"]))]),_:1})]),_:1})]),_:1}),o(D,{variant:"text",size:"small",class:"text-center"},{default:r(()=>[n[8]||(n[8]=U(" 回報問題 ")),o(v)]),_:1}),o(D,{variant:"text",size:"small",class:"text-center",href:"https://forms.gle/WzW9PZwUU6gqHZko7",target:"_blank"},{default:r(()=>n[9]||(n[9]=[U(" 投稿 ")])),_:1})]),_:1}),o(B,{cols:"1"},{default:r(()=>[o(D,{variant:"text",size:"small",density:"comfortable",icon:h(se)},{default:r(()=>[o(Y,{icon:h(se),"aria-label":"設定"},null,8,["icon"]),o(L,{activator:"parent","max-width":"600px",style:{maxHeight:"90vh",minHeight:"200px"}},{default:r(()=>[o(j,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:r(()=>[n[14]||(n[14]=k("br",null,null,-1)),n[15]||(n[15]=k("span",{class:"ml-2 d-flex align-center"},"主題",-1)),o(B,{cols:"auto",class:"d-flex align-center"},{default:r(()=>[n[10]||(n[10]=k("span",{class:"mr-2 d-flex align-center"},"淺色",-1)),o(le,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=g=>l.value=g),class:"mx-2 d-flex align-center"},null,8,["modelValue"]),n[11]||(n[11]=k("span",{class:"ml-2 d-flex align-center"},"深色",-1))]),_:1}),n[16]||(n[16]=k("br",null,null,-1)),n[17]||(n[17]=k("span",{class:"ml-2 d-flex align-center"},"偏好複製模式",-1)),o(B,{cols:"auto",class:"d-flex align-center"},{default:r(()=>[n[12]||(n[12]=k("span",{class:"mr-2 d-flex align-center"},"複製圖片",-1)),o(le,{modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=g=>u.value=g),class:"mx-2 d-flex align-center",disabled:!e.value},null,8,["modelValue","disabled"]),n[13]||(n[13]=k("span",{class:"ml-2 d-flex align-center"},"複製連結",-1))]),_:1}),e.value?ee("",!0):(I(),O("span",rt,"您的瀏覽器不支援複製圖片")),n[18]||(n[18]=k("br",null,null,-1))]),_:1})]),_:1})]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}});function it(a,t,e,l,u=!1){return`${a}${t}/${e}/${l}.webp${u?"?old":""}`}function ut(a,t,e){const l=a===R.AVE_MUJICA?J[R.AVE_MUJICA]:J[R.MYGO];var u=H.videoLink;const c=String(t);return`${u[l][c]}&t=${e}s`}function Se(a,t){return`${a===R.AVE_MUJICA?J[R.AVE_MUJICA]:J[R.MYGO]} 第${t}話`}function ct(a){const t=a/be;return{minutes:Math.floor(t/60),seconds:Math.floor(t%60),totalSeconds:Math.round(t)}}function dt(a){return`${a.minutes}:${String(a.seconds).padStart(2,"0")}`}function Ce(a){const t=ct(a);return dt(t)}function mt(a,t,e,l){const u=l?t[e]:0;return Math.round((a+u)/be)}const pt=["src","alt"],ft={class:"timestamp-overlay"},gt={class:"card-text text-center justify-center"},vt=F({__name:"CardThumbnail",props:{cardData:{type:Object,required:!0},imageUrl:{type:String,required:!0}},emits:["click"],setup(a){const t=a,e=t.cardData.text,l=t.cardData.season,u=t.cardData.episode,c=t.cardData.frame.start;t.cardData.frame.prefer;const p=$(()=>Se(l,u)),f=$(()=>Ce(c));return(m,i)=>(I(),O("div",null,[o(j,{class:"card-size",color:"surface-variant",rounded:"lg",variant:"tonal",onClick:i[0]||(i[0]=d=>m.$emit("click"))},{default:r(()=>[k("img",{src:t.imageUrl,class:"img-size",alt:h(e)},null,8,pt),k("div",ft,A(p.value)+" "+A(f.value),1),k("div",gt,A(h(e)),1)]),_:1})]))}}),Z=(a,t)=>{const e=a.__vccOpts||a;for(const[l,u]of t)e[l]=u;return e},wt=Z(vt,[["__scopeId","data-v-20b0d884"]]);function yt(){let a=null;const t=()=>{if(a)return a;const u=document.createElement("canvas"),c=u.getContext("2d",{alpha:!1,willReadFrequently:!0});if(!c)throw new Error("Failed to get canvas context");return a={canvas:u,ctx:c},a};return{getContext:t,createPngBlob:u=>{const{canvas:c,ctx:p}=t();return c.width=u.width,c.height=u.height,p.drawImage(u,0,0),c.toDataURL("image/png")},cleanup:()=>{a&&(a.canvas.width=0,a.canvas.height=0,a=null)}}}function ht(a){const t=y([]),e=y([]),l=y({}),u=()=>{var s;return{timestamp:Date.now(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,platform:typeof navigator<"u"?navigator.platform:"unknown",screenResolution:typeof window<"u"?`${window.screen.width}x${window.screen.height}`:void 0,language:typeof navigator<"u"?navigator.language:"unknown",memoryUsage:(s=performance==null?void 0:performance.memory)==null?void 0:s.usedJSHeapSize}},c=s=>({path:(s==null?void 0:s.path)||window.location.pathname,lastAction:t.value[t.value.length-1],componentStack:[...e.value],lastStateChange:{...l.value}}),p=s=>{t.value=[...t.value.slice(-9),s]},f=(s,C)=>{if(C)e.value.push(s);else{const S=e.value.lastIndexOf(s);S!==-1&&e.value.splice(S,1)}},m=(s,C)=>{if(l.value[s]=C,Object.keys(l.value).length>10){const S=Object.keys(l.value);delete l.value[S[0]]}},i=s=>s instanceof TypeError||s instanceof ReferenceError?"critical":s.message.includes("network")||s.message.includes("fetch")?"high":s.message.includes("undefined")||s.message.includes("null")?"medium":"low",d=(s,C,S)=>({name:s.name,message:s.message,stack:s.stack,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,severity:i(s),systemInfo:u(),userContext:c(C),additionalInfo:S}),n=async(s,C,S)=>{var w;const b=d(typeof s=="string"?new Error(s):s,C,S),E=[`[${b.severity.toUpperCase()}] Error in ${a.context||"unknown context"}:`,`Time: ${new Date(b.systemInfo.timestamp).toISOString()}`,`Name: ${b.name}`,`Message: ${b.message}`,`Path: ${b.userContext.path}`,`Last Action: ${b.userContext.lastAction||"none"}`,`Component Stack: ${(w=b.userContext.componentStack)==null?void 0:w.join(" -> ")}`,b.userAgent?`UserAgent: ${b.userAgent}`:null,`System Info: ${JSON.stringify(b.systemInfo,null,2)}`,b.stack?`Stack: ${b.stack}`:null,b.additionalInfo?`Additional Info: ${JSON.stringify(b.additionalInfo,null,2)}`:null,b.userContext.lastStateChange?`Last State Changes: ${JSON.stringify(b.userContext.lastStateChange,null,2)}`:null].filter(Boolean).join(`

`),T=a.maxRetries||3;let x=0;for(;x<T;)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:E})});break}catch(V){if(x++,x===T){console.error("Failed to send error report after multiple retries:",V);const M=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");M.push({content:E,timestamp:Date.now()}),localStorage.setItem("failedErrorReports",JSON.stringify(M))}await new Promise(M=>setTimeout(M,1e3*x))}},v=s=>(C,S,b)=>n(C,S,{...b,context:s});return typeof window<"u"&&setInterval(async()=>{const s=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");if(s.length===0)return;const C=[];for(const S of s)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:S.content})})}catch{Date.now()-S.timestamp<24*60*60*1e3&&C.push(S)}localStorage.setItem("failedErrorReports",JSON.stringify(C))},30*60*1e3),{reportError:n,reportWithContext:v,trackAction:p,trackComponent:f,trackStateChange:m}}function bt(a){const t=yt(),e=ht({webhookUrl:a.webhookUrl,context:"ImageOperations"}),l=$e({isDownloading:!1,isCopying:!1,operationStatus:""}),u=d=>{const n=new Image;return n.crossOrigin="Anonymous",n.src=d,n},c=d=>new Promise((n,v)=>{const g=u(d);g.onload=()=>n(g),g.onerror=v}),p=(d,n)=>{if(l.isDownloading)return;e.trackAction(`download_image_start:${n}`),l.isDownloading=!0,l.operationStatus="下載中...";const v=u(d);v.onload=()=>{const g=t.createPngBlob(v),s=document.createElement("a");s.href=g,s.download=`${n}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s),l.operationStatus="下載完成",e.trackAction(`download_image_success:${n}`),l.isDownloading=!1},v.onerror=()=>{e.trackAction(`download_image_error:${n}`),e.reportError(new Error("Failed to load image"),void 0,{imageUrl:d,filename:n,operation:"download"}),l.operationStatus="下載失敗",l.isDownloading=!1}},f=async d=>{if(l.isCopying)return;e.trackAction("copy_image_start"),l.isCopying=!0,l.operationStatus="";const n=new Promise((v,g)=>{c(d).then(s=>{const S=t.createPngBlob(s).split(","),b=atob(S[1]),E=b.length,T=new Uint8Array(E);for(let x=0;x<E;x++)T[x]=b.charCodeAt(x);v(new Blob([T],{type:"image/png"}))}).catch(g)});try{const v=new ClipboardItem({"image/png":n});await navigator.clipboard.write([v]),l.operationStatus="圖片複製成功",e.trackAction("copy_image_success")}catch(v){throw e.trackAction("copy_image_error"),e.reportError(v,void 0,{imageUrl:d,operation:"copyImage",clipboardSupported:!!navigator.clipboard}),l.operationStatus="複製失敗，請稍後重試",v}finally{l.isCopying=!1}},m=async d=>{if(!l.isCopying){e.trackAction("copy_url_start"),l.isCopying=!0,l.operationStatus="";try{await navigator.clipboard.writeText(d),l.operationStatus="連結複製成功",e.trackAction("copy_url_success")}catch(n){throw e.trackAction("copy_url_error"),e.reportError(n,void 0,{url:d,operation:"copyUrl",clipboardSupported:!!navigator.clipboard}),l.operationStatus="複製失敗",n}finally{l.isCopying=!1}}},i=()=>{t.cleanup(),e.trackAction("image_operations_cleanup")};return e.trackComponent("ImageOperations",!0),{isDownloading:X(l,"isDownloading"),isCopying:X(l,"isCopying"),operationStatus:X(l,"operationStatus"),downloadImage:p,copyImage:f,copyUrl:m,cleanup:i}}const xt={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},kt=F({__name:"ActionButtons",props:{cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["gif-create"],setup(a,{emit:t}){const e=a,l=t,u=q(),c=y(!1),p=bt({webhookUrl:e.webhookUrl}),f=y(!1);ae(()=>p.operationStatus.value,g=>{g&&(f.value=!0)});const m=$(()=>{const g=mt(e.cardData.frame.start,Ke,e.cardData.episode,e.cardData.season===R.MYGO);return ut(e.cardData.season,e.cardData.episode,g)}),i=()=>{p.downloadImage(e.imageUrl,e.cardData.text)},d=async()=>{if(c.value){c.value=!1;return}try{u.copyMode?await p.copyUrl(e.imageUrl):await p.copyImage(e.imageUrl)}catch{}},n=async()=>{try{c.value=!0,await p.copyUrl(e.imageUrl)}catch{}},v=()=>{l("gif-create")};return me(()=>{c.value=!1}),(g,s)=>{const C=Me("long-press");return I(),O(Q,null,[o(N,null,{default:r(()=>[o(D,null,{default:r(()=>[s[1]||(s[1]=U(" 回報 ")),pe(g.$slots,"report-dialog")]),_:3}),o(D,{onClick:i,loading:h(p).isDownloading.value},{default:r(()=>s[2]||(s[2]=[U("下載")])),_:1},8,["loading"]),o(D,{onClick:v,loading:a.isGifCreating},{default:r(()=>s[3]||(s[3]=[U("GIF")])),_:1},8,["loading"]),Fe((I(),_(D,{onClick:d,loading:h(p).isCopying.value},{default:r(()=>s[4]||(s[4]=[U("複製")])),_:1},8,["loading"])),[[C,n]]),o(D,{href:m.value,target:"_blank"},{default:r(()=>s[5]||(s[5]=[U(" 從這裡開始看 ")])),_:1},8,["href"])]),_:3}),o(oe,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=S=>f.value=S),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>[k("div",xt,A(h(p).operationStatus),1)]),_:1},8,["modelValue"])],64)}}}),St={style:{position:"relative"}},Ct={class:"timestamp-overlay"},It=F({__name:"CardDialog",props:{show:{type:Boolean,required:!0},cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["update:show","gif-create"],setup(a){const t=a,e=t.cardData.text,l=t.cardData.season,u=t.cardData.episode,c=t.cardData.frame.start,p=$(()=>Se(l,u)),f=$(()=>Ce(c));return(m,i)=>(I(),_(L,{"model-value":a.show,"onUpdate:modelValue":i[1]||(i[1]=d=>m.$emit("update:show",d)),"max-width":"600px",style:{maxHeight:"90vh"}},{default:r(()=>[o(j,null,{default:r(()=>[k("div",St,[o(we,{src:a.imageUrl,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),k("div",Ct,A(p.value)+" "+A(f.value),1)]),o(N,null,{default:r(()=>[o(B,null,{default:r(()=>[o(ge,{class:"text-center"},{default:r(()=>[U(A(h(e)),1)]),_:1})]),_:1})]),_:1}),o(W,null,{default:r(()=>[o(kt,{"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":a.imageUrl,"is-gif-creating":a.isGifCreating,onGifCreate:i[0]||(i[0]=d=>m.$emit("gif-create"))},{"report-dialog":r(()=>[pe(m.$slots,"report-dialog",{},void 0,!0)]),_:3},8,["card-data","webhook-url","image-url","is-gif-creating"])]),_:3})]),_:3})]),_:3},8,["model-value"]))}}),Vt=Z(It,[["__scopeId","data-v-5cf36450"]]),Ut={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},Dt="https://mypic.0m0.uk/images/",_t=F({__name:"GifDialog",props:{text:{},season:{},episode:{},frameStart:{},frameEnd:{}},setup(a,{expose:t}){const e=new tt;let l=!1;const u=a,c=y(!1),p=y(!1),f=y(""),m=y(!1),i=y(!1),d=y(!1),n=y(""),v=y(null),g=y(null);async function s(){l||(await e.load(),l=!0)}async function C(){if(!v.value)return;const x=document.createElement("a");x.href=URL.createObjectURL(v.value),x.download=`${u.text}.gif`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(x.href)}async function S(){const x=new File([v.value],"download.gif",{type:"image/gif"}),w=new FormData;w.append("fileToUpload",x),w.append("reqtype","fileupload");const V=await fetch("https://cors.0m0.uk/?https://catbox.moe/user/api.php",{method:"POST",body:w});if(V.status===412)throw new Error("GIF檔案過大，請自行下載後上傳至其他圖床");return await V.text()}async function b(){if(!v.value)return;d.value=!0;const x=new ClipboardItem({"text/plain":(async()=>{if(g.value)return new Blob([g.value],{type:"text/plain"});f.value="正在上傳GIF...",p.value=!0;const w=await S();return g.value=w,new Blob([w],{type:"text/plain"})})()});try{await navigator.clipboard.write([x]),f.value="GIF 連結複製成功"}catch(w){w instanceof Error&&w.name==="NotAllowedError"?f.value="GIF 連結複製失敗":f.value=w instanceof Error?w.message:"GIF 上傳失敗",T(w)}finally{p.value=!0,d.value=!1}}async function E(){if(m.value)return;if(v.value){c.value=!0;return}g.value=null,m.value=!0,f.value="GIF生成中...",p.value=!0;const x=performance.now(),w=Array.from({length:u.frameEnd-u.frameStart-4},(V,M)=>u.frameStart+M+2);try{await s();const V=w.map(async ne=>{const Ve=`${Dt}${u.season}/${u.episode}/${ne}.webp`,Ue=await et(Ve);await e.writeFile(`${ne}.webp`,Ue)});await Promise.all(V),await e.exec(["-start_number",w[0].toString(),"-i","%d.webp","-vf","palettegen","palette.png"]),await e.exec(["-start_number",w[0].toString(),"-i","%d.webp","-i","palette.png","-filter_complex","paletteuse=dither=none","-frames:v",w.length.toString(),"-f","gif","-framerate","24","output.gif"]);const M=await e.readFile("output.gif");v.value=new Blob([M],{type:"image/gif"}),n.value=URL.createObjectURL(v.value);const Ie=((performance.now()-x)/1e3).toFixed(1);f.value=`GIF生成完成 (${Ie}秒)`,c.value=!0}catch(V){console.error("GIF generation failed:",V),T(V),f.value="GIF生成失敗"}finally{m.value=!1,p.value=!0;const V=w.map(M=>e.deleteFile(`${M}.webp`).catch(console.error));await Promise.all([...V,e.deleteFile("output.gif").catch(console.error),e.deleteFile("palette.png").catch(console.error)])}}async function T(x){const w={content:`Copy failed: ${x.name}

${navigator.userAgent}

${x.message}

${x.stack}`};try{await fetch(`https://discord.com/api/webhooks/${atob(H.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)})}catch(V){console.error("Failed to send error report to Discord:",V)}}return t({CreateGif:E,isGeneratingGif:m}),(x,w)=>(I(),O(Q,null,[o(L,{modelValue:c.value,"onUpdate:modelValue":w[0]||(w[0]=V=>c.value=V),"max-width":"600px",style:{maxHeight:"90vh"}},{default:r(()=>[o(j,null,{default:r(()=>[o(we,{src:n.value,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),o(W,null,{default:r(()=>[o(N,null,{default:r(()=>[o(D,{onClick:C,loading:i.value},{default:r(()=>w[2]||(w[2]=[U("下載")])),_:1},8,["loading"]),o(D,{onClick:b,loading:d.value},{default:r(()=>w[3]||(w[3]=[U("生成連結")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(oe,{modelValue:p.value,"onUpdate:modelValue":w[1]||(w[1]=V=>p.value=V),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>[k("div",Ut,A(f.value),1)]),_:1},8,["modelValue"])],64))}}),$t=F({__name:"index",props:{styles:{type:Object,required:!0},cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},baseImageUrl:{type:String,default:"https://mypic.0m0.uk/images/"}},setup(a){const t=a,e=q(),l=y(!1),u=y(null),c=$(()=>it(t.baseImageUrl,t.cardData.season,t.cardData.episode,t.cardData.frame.prefer,e.wayBackMode)),p=async()=>{u.value&&await u.value.CreateGif()};return(f,m)=>{var i;return I(),O("div",{style:fe(a.styles)},[o(wt,{"card-data":a.cardData,"image-url":c.value,onClick:m[0]||(m[0]=d=>l.value=!0)},null,8,["card-data","image-url"]),o(Vt,{show:l.value,"onUpdate:show":m[1]||(m[1]=d=>l.value=d),"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":c.value,onGifCreate:p,"is-gif-creating":(i=u.value)==null?void 0:i.isGeneratingGif},{"report-dialog":r(()=>[o(ke,{"file-name":c.value,text:a.cardData.text},null,8,["file-name","text"])]),_:1},8,["show","card-data","webhook-url","image-url","is-gif-creating"]),o(_t,{ref_key:"gifDialogRef",ref:u,text:a.cardData.text,season:a.cardData.season,episode:a.cardData.episode,"frame-start":a.cardData.frame.start,"frame-end":a.cardData.frame.end},null,8,["text","season","episode","frame-start","frame-end"])],4)}}}),Mt=F({__name:"ResultGrid",setup(a){const t=ot(),{filteredCards:e}=Xe(t),l=$(()=>`https://discord.com/api/webhooks/${atob(H.webhook)}`);let u=y(24);const c=()=>{var m=Math.max(0,window.innerWidth-290),i=Math.floor(m/270)+1;u.value=i*8},p=$(()=>{typeof window<"u"&&window.scrollTo({top:0,left:0,behavior:"smooth"});const m=e.value;return(i,d)=>{const n=m.slice(i*d,(i+1)*d);return Promise.resolve(n)}}),f=m=>{var i;return(i=m.value)==null?void 0:i.segmentId};return de(()=>{c(),window.addEventListener("resize",c)}),me(()=>{window.removeEventListener("resize",c)}),(m,i)=>(I(),_(Ae,null,{default:r(()=>[o(h(at),{length:h(e).length?h(e).length:1,pageSize:h(u),pageProvider:p.value,"get-key":f,class:"grid ma-5"},{probe:r(()=>i[0]||(i[0]=[k("div",{class:"card-size"},"Probe",-1)])),placeholder:r(({index:d,style:n})=>[k("div",{class:"card-size",style:fe(n)},A(h(e).length?"還在GO...":""),5)]),default:r(({item:d,style:n,index:v})=>[o($t,{styles:n,"card-data":d,"webhook-url":l.value},null,8,["styles","card-data","webhook-url"])]),_:1},8,["length","pageSize","pageProvider"])]),fallback:r(()=>i[1]||(i[1]=[k("p",null,"Loading...",-1)])),_:1}))}}),Ft=Z(Mt,[["__scopeId","data-v-0fa41b50"]]),ce=F({__name:"MultiSelect",props:Re({items:{type:Array,required:!0},label:{type:String,required:!1,default:"Select"}},{modelValue:{type:Array,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const t=a,e=Te(a,"modelValue"),l=$(()=>e.value.length===t.items.length),u=$(()=>e.value.length>0&&e.value.length<t.items.length),c=()=>{l.value?e.value=[]:e.value=[...t.items]};return ae(e,()=>{e.value.sort()}),(p,f)=>(I(),_(Le,{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=m=>e.value=m),label:a.label,variant:"outlined",multiple:"",items:a.items,style:{"min-width":"250px"}},{"prepend-item":r(()=>[o(P,{title:"全選",onClick:c},{prepend:r(()=>[o(Ne,{indeterminate:u.value,"model-value":l.value},null,8,["indeterminate","model-value"])]),_:1}),o(qe,{class:"mt-2"})]),selection:r(({item:m,index:i})=>[e.value.length!=a.items.length?(I(),_(re,{key:0},{default:r(()=>[k("span",null,A(m.value),1)]),_:2},1024)):ee("",!0),i===a.items.length-1?(I(),_(re,{key:1},{default:r(()=>f[1]||(f[1]=[k("span",null,"全選",-1)])),_:1})):ee("",!0)]),_:1},8,["modelValue","label","items"]))}}),At=F({__name:"FilterDialog",setup(a){const t=ye(),e=y(!1),l=y([]),u=y([]),c=y([]);ae(e,m=>{m&&(u.value=[...t.mygoEpisodes],c.value=[...t.avemujicaEpisodes])});const p=()=>{u.value=[],c.value=[],l.value=[]},f=()=>{t.mygoEpisodesBuffer=[...u.value],t.avemujicaEpisodesBuffer=[...c.value],t.characterIdBuffer=0,t.flush(),e.value=!1};return(m,i)=>(I(),_(L,{modelValue:e.value,"onUpdate:modelValue":i[2]||(i[2]=d=>e.value=d),"max-width":"600px",style:{"min-height":"600px"},transition:"dialog-top-transition"},{activator:r(({props:d})=>[o(Y,Ee(d,{icon:h(Je)}),null,16,["icon"])]),default:r(()=>[o(j,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:r(()=>[i[3]||(i[3]=k("br",null,null,-1)),i[4]||(i[4]=k("br",null,null,-1)),i[5]||(i[5]=k("span",{class:"align-center"},"集數篩選",-1)),o(ce,{items:h(ie),modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=d=>u.value=d),label:"MyGO",style:{"min-width":"250px"}},null,8,["items","modelValue"]),o(ce,{items:h(ie),modelValue:c.value,"onUpdate:modelValue":i[1]||(i[1]=d=>c.value=d),label:"Ave Mujica",style:{"min-width":"250px"}},null,8,["items","modelValue"]),o(W,null,{default:r(()=>[o(D,{class:"text-center",text:"清除篩選",onClick:p}),o(D,{class:"text-center",text:"確定",onClick:f})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Rt=F({__name:"AppBarComponent",setup(a){const t=q(),e=he(),l=()=>{e.flush()},u=()=>{e.queryBuffer="",e.flush()};return(c,p)=>{const f=At;return I(),_(Ye,{density:"prominent"},{default:r(()=>[o(ve,null,{default:r(()=>[p[1]||(p[1]=k("div",{class:"text-h5 mx-auto font-weight-bold text-center text-truncate"}," MyGO Mujica 截圖搜尋器 ",-1)),o(N,{dense:"",class:"mt-2"},{default:r(()=>[o(B,{class:"text-center"},{default:r(()=>[o(te,{modelValue:h(e).queryBuffer,"onUpdate:modelValue":p[0]||(p[0]=m=>h(e).queryBuffer=m),"single-line":"","hide-details":"",clearable:"",label:"搜尋",variant:"outlined",class:"short-search",onKeyup:Oe(l,["enter"]),"onClick:clear":u,autofocus:""},{append:r(()=>[o(Y,{onClick:h(t).toggleReverse,icon:h(t).isReversed?h(Qe):h(We)},null,8,["onClick","icon"]),o(D,{text:"時空機",onClick:h(t).togglewayBackMode},null,8,["onClick"])]),"append-inner":r(()=>[o(f)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Tt={};function Et(a,t){const e=Rt,l=Ft,u=st;return I(),O(Q,null,[o(e),o(l),o(u,{style:{width:"100%"}})],64)}const ea=Z(Tt,[["render",Et]]);export{ea as default};
