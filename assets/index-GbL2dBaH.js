var De=Object.defineProperty;var _e=(a,t,e)=>t in a?De(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var K=(a,t,e)=>_e(a,typeof t!="symbol"?t+"":t,e);import{r as h,c as _,k as R,D as I,I as O,X as n,F as l,a5 as V,a7 as k,J as W,l as me,E as $,u as y,a8 as ee,$ as A,f as Me,b as X,w as ae,O as pe,a2 as Fe,H as fe,B as Re,L as ge,a9 as Ae,aa as Te,ab as Ee,Y as Oe,ac as Ge}from"./@vue-D9bH4lrz.js";import{e as z,f as Pe,g as oe,h as te,i as H,j as D,k as L,l as ne,u as je,n as ze,o as N,p as j,q as Be,r as Le,s as Y,t as P,v as B,w as le,x as ve,y as we,z as Ne,A as qe,B as se,C as Ye,D as Je}from"./vuetify-CJKEy0vb.js";import{m as G,a as ie,b as Qe,c as We,d as He}from"./@mdi-DKC2W5MC.js";import{u as Ze,a as ye,b as he,S as F,n as Ke,c as J,F as be,M as Xe,E as ue}from"./app-2zKAF_fS.js";import{d as xe,s as et}from"./pinia-B-uPeou1.js";import{f as tt,F as at}from"./@ffmpeg-B1ncfXmI.js";import{G as ot}from"./vue-virtual-scroll-grid-DSIWnnUt.js";import"./vite-ssg-CQCaBNHx.js";import"./vue-router-Y811DZoV.js";import"./@unhead-DsvcCsHo.js";import"./unhead-CpyiRjm1.js";import"./hookable-B7_1qfUG.js";import"./protobufjs-CgPuVhCO.js";import"./@protobufjs-f4nnaicZ.js";import"./opencc-js-D2OnpAg6.js";const q=xe("ui",()=>{const a=h(!1),t=h(!1);return{isReversed:a,copyMode:t,toggleReverse:()=>{a.value=!a.value},toggleCopyMode:()=>{t.value=!t.value}}});class ce{constructor(t){K(this,"cache");K(this,"capacity");if(t<=0)throw new Error("Cache capacity must be greater than 0");this.cache=new Map,this.capacity=t}has(t){return this.cache.has(t)}get(t){const e=this.cache.get(t);if(e)return this.cache.delete(t),this.cache.set(t,e),e}set(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.capacity){const r=this.cache.keys().next();r.done||this.cache.delete(r.value)}this.cache.set(t,e)}clear(){this.cache.clear()}get size(){return this.cache.size}get maxSize(){return this.capacity}keys(){return this.cache.keys()}values(){return this.cache.values()}entries(){return this.cache.entries()}}const nt=xe("results",()=>{const a=Ze(),t=ye(),e=he(),r=q(),c=new ce(50),m=new ce(50),f=i=>{const u=Array.from(i.mygo).sort().join(","),o=Array.from(i.avemujica).sort().join(",");return`mygo:${u}|avemujica:${o}`},p=i=>{for(const u of i)u.text&&!u.normalizedText&&(u.normalizedText=Ke(u.text));return i};return{filteredCards:_(()=>{const i=a.cards;if(!i.length)return[];const u=p([...i]),o=t.activeFilters,w=f(o);let v;if(c.has(w)?v=c.get(w):(v=u.filter(s=>o.mygo.size&&s.season===F.MYGO?o.mygo.has(s.episode):o.avemujica.size&&s.season===F.AVE_MUJICA?o.avemujica.has(s.episode):o.mygo.size===0&&o.avemujica.size===0),c.set(w,v)),e.normalizedQuery){const s=`${w}:search:${e.normalizedQuery}`;if(m.has(s))v=m.get(s);else{const C=v.filter(S=>{var b;return(b=S.normalizedText)==null?void 0:b.includes(e.normalizedQuery)});m.set(s,C),v=C}}return r.isReversed?[...v].reverse():v})}}),rt="MTMzNTEwMzQ1NzY4MTczNTc2MC9LT0lwZ2FDc3RmRURnVHVqR2dEYmVYWWZSLUdZRjVQQ29veXZ0TFVGbFhFM0tYdGRGTzhHR3RrTXptWEp4R3FxQVI5bw==",lt={MyGO:{1:"https://www.youtube.com/watch?v=WOrYBIYIwyk",2:"https://www.youtube.com/watch?v=WOrYBIYIwyk",3:"https://www.youtube.com/watch?v=WOrYBIYIwyk",4:"https://www.youtube.com/watch?v=ijdspfPMzYc",5:"https://www.youtube.com/watch?v=zfA0zRAkAdk",6:"https://www.youtube.com/watch?v=UwgyEoB9vU8",7:"https://www.youtube.com/watch?v=rlY2b3TIYPs",8:"https://www.youtube.com/watch?v=mfboDpl88QY",9:"https://www.youtube.com/watch?v=ySjYENzyZmY",10:"https://www.youtube.com/watch?v=bLWDIYpGcEI",11:"https://www.youtube.com/watch?v=gAFDVnhX24o",12:"https://www.youtube.com/watch?v=wei3payuSi8",13:"https://www.youtube.com/watch?v=uQ3_PvPCNnI"},"Ave Mujica":{1:"https://www.youtube.com/watch?v=dxmmSFQxWzM",2:"https://www.youtube.com/watch?v=Bzl61esi4qc",3:"https://www.youtube.com/watch?v=HagaJboujK4",4:"https://www.youtube.com/watch?v=Z6cOxtDsfNU",5:"https://www.youtube.com/watch?v=7D2uGv7aprQ",6:"https://www.youtube.com/watch?v=jQraN1emvLQ",7:"https://www.youtube.com/watch?v=RONGNWb7OpQ",8:"https://www.youtube.com/watch?v=uh9jUhVTS28",9:"https://www.youtube.com/watch?v=pGrI6hk0vBg",10:"https://www.youtube.com/watch?v=m9cjOcCKIyQ",11:"https://www.youtube.com/watch?v=Cfm8TWGkvYQ",12:"https://www.youtube.com/watch?v=UtSEFdDZZLw"}},Q={webhook:rt,videoLink:lt},ke=R({__name:"ReportDialog",props:{fileName:{type:String,required:!1,default:""},text:{type:String,required:!1,default:""}},setup(a){const t=a,e=h(""),r=h(""),c=h(!1),m=h(!1);async function f(){let p="";if(e.value&&(p+=`問題: ${e.value}
`),r.value&&(p+=`聯絡方式: ${r.value}
`),t.fileName&&(p+=`檔案名稱: ${t.fileName}
`),t.text&&(p+=`文字: ${t.text}
`),p){const d={content:p};await fetch(`https://discord.com/api/webhooks/${atob(Q.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),c.value=!0}m.value=!1}return(p,d)=>(I(),O(W,null,[n(L,{modelValue:m.value,"onUpdate:modelValue":d[2]||(d[2]=i=>m.value=i),activator:"parent","max-width":"600px",style:{maxHeight:"90vh"},transition:"dialog-bottom-transition"},{default:l(()=>[n(z,null,{default:l(()=>[n(Pe,null,{default:l(()=>d[4]||(d[4]=[V("回報問題")])),_:1}),n(oe,null,{default:l(()=>[n(te,{label:"你遭遇到的問題(選填)",modelValue:e.value,"onUpdate:modelValue":d[0]||(d[0]=i=>e.value=i),outlined:""},null,8,["modelValue"]),n(te,{label:"你的聯絡方式(選填)",modelValue:r.value,"onUpdate:modelValue":d[1]||(d[1]=i=>r.value=i),outlined:""},null,8,["modelValue"])]),_:1}),n(H,null,{default:l(()=>[n(D,{onClick:f},{default:l(()=>d[5]||(d[5]=[V("送出")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(ne,{modelValue:c.value,"onUpdate:modelValue":d[3]||(d[3]=i=>c.value=i),timeout:2e3,class:"text-center",rounded:"pill"},{default:l(()=>d[6]||(d[6]=[k("div",{class:"text-h6 mx-auto font-weight-bold text-center text-truncate"}," 已回報問題 ",-1)])),_:1},8,["modelValue"])],64))}}),st={key:0,class:"ml-2 d-flex align-center"},it=R({__name:"FooterComponent",setup(a){const t=q(),e=h(!0),r=_({get(){return m.global.current.value.dark},set(u){f(u)}}),c=_({get(){return t.copyMode},set(u){t.copyMode=u,localStorage.setItem("copyURLMode",u.toString())}}),m=je();function f(u){m.global.name.value=u?"dark":"light",localStorage.setItem("darkTheme",m.global.name.value)}const p=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("firefox"),d=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("mobile"),i=()=>!(p()&&d());return me(()=>{e.value=i(),e.value?localStorage.getItem("copyURLMode")?t.copyMode=localStorage.getItem("copyURLMode")==="true":t.copyMode=!1:t.copyMode=!0,localStorage.getItem("darkTheme")?m.global.name.value=localStorage.getItem("darkTheme")??"dark":window.matchMedia("(prefers-color-scheme: light)").matches&&(m.global.name.value="light")}),(u,o)=>{const w=ke;return I(),$(ze,{app:""},{default:l(()=>[n(ve,{fluid:"",style:{padding:"5px"}},{default:l(()=>[n(N,null,{default:l(()=>[n(j,null,{default:l(()=>[n(D,{variant:"text",size:"small",class:"text-center"},{default:l(()=>[o[7]||(o[7]=V(" 其他連結 ")),n(Be,{activator:"parent",location:"center"},{default:l(()=>[n(Le,null,{default:l(()=>[n(Y,{icon:`mdiSvg:${y(G)}`},null,8,["icon"]),(I(),$(P,{key:0,target:"_blank",value:0,"append-icon":y(G),href:"https://github.com/NightFeather0615/Its-MyPic-Android"},{default:l(()=>[n(B,null,{default:l(()=>o[2]||(o[2]=[V("Its-MyPic for Android")])),_:1})]),_:1},8,["append-icon"])),(I(),$(P,{key:1,target:"_blank",value:1,"append-icon":y(G),href:"https://github.com/Its-MyPic/PowerToys-Run-Its-MyPic"},{default:l(()=>[n(B,null,{default:l(()=>o[3]||(o[3]=[V("PowerToys-Run Plugin")])),_:1})]),_:1},8,["append-icon"])),(I(),$(P,{key:2,target:"_blank",value:2,"append-icon":y(G),href:"https://github.com/Its-MyPic/krunner-Its-MyPic"},{default:l(()=>[n(B,null,{default:l(()=>o[4]||(o[4]=[V("Krunner Plugin")])),_:1})]),_:1},8,["append-icon"])),(I(),$(P,{key:3,target:"_blank",value:3,"append-icon":y(G),href:"https://github.com/Its-MyPic/Its-MyPic-vue"},{default:l(()=>[n(B,null,{default:l(()=>o[5]||(o[5]=[V("這個網頁的原始碼")])),_:1})]),_:1},8,["append-icon"])),(I(),$(P,{key:4,target:"_blank",value:4,"append-icon":y(G),href:"https://github.com/Its-MyPic/Its-MyPicDB"},{default:l(()=>[n(B,null,{default:l(()=>o[6]||(o[6]=[V("mygo系列的截圖資料")])),_:1})]),_:1},8,["append-icon"]))]),_:1})]),_:1})]),_:1}),n(D,{variant:"text",size:"small",class:"text-center"},{default:l(()=>[o[8]||(o[8]=V(" 回報問題 ")),n(w)]),_:1}),n(D,{variant:"text",size:"small",class:"text-center",href:"https://forms.gle/WzW9PZwUU6gqHZko7",target:"_blank"},{default:l(()=>o[9]||(o[9]=[V(" 投稿 ")])),_:1})]),_:1}),n(j,{cols:"1"},{default:l(()=>[n(D,{variant:"text",size:"small",density:"comfortable",icon:y(ie)},{default:l(()=>[n(Y,{icon:y(ie),"aria-label":"設定"},null,8,["icon"]),n(L,{activator:"parent","max-width":"600px",style:{maxHeight:"90vh",minHeight:"200px"}},{default:l(()=>[n(z,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:l(()=>[o[14]||(o[14]=k("br",null,null,-1)),o[15]||(o[15]=k("span",{class:"ml-2 d-flex align-center"},"主題",-1)),n(j,{cols:"auto",class:"d-flex align-center"},{default:l(()=>[o[10]||(o[10]=k("span",{class:"mr-2 d-flex align-center"},"淺色",-1)),n(le,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=v=>r.value=v),class:"mx-2 d-flex align-center"},null,8,["modelValue"]),o[11]||(o[11]=k("span",{class:"ml-2 d-flex align-center"},"深色",-1))]),_:1}),o[16]||(o[16]=k("br",null,null,-1)),o[17]||(o[17]=k("span",{class:"ml-2 d-flex align-center"},"偏好複製模式",-1)),n(j,{cols:"auto",class:"d-flex align-center"},{default:l(()=>[o[12]||(o[12]=k("span",{class:"mr-2 d-flex align-center"},"複製圖片",-1)),n(le,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=v=>c.value=v),class:"mx-2 d-flex align-center",disabled:!e.value},null,8,["modelValue","disabled"]),o[13]||(o[13]=k("span",{class:"ml-2 d-flex align-center"},"複製連結",-1))]),_:1}),e.value?ee("",!0):(I(),O("span",st,"您的瀏覽器不支援複製圖片")),o[18]||(o[18]=k("br",null,null,-1))]),_:1})]),_:1})]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}});function Se(a,t,e,r){return`${a}${t}/${e}/${r}.webp`}function ut(a,t,e,r){const c=t===F.AVE_MUJICA?J[F.AVE_MUJICA]:J[F.MYGO],m=String(e);return`${a[c][m]}&t=${r}s`}function Ce(a,t){return`${a===F.AVE_MUJICA?J[F.AVE_MUJICA]:J[F.MYGO]} 第${t}話`}function ct(a){const t=a/be;return{minutes:Math.floor(t/60),seconds:Math.floor(t%60),totalSeconds:Math.round(t)}}function dt(a){return`${a.minutes}:${String(a.seconds).padStart(2,"0")}`}function Ie(a){const t=ct(a);return dt(t)}function mt(a,t,e,r){const c=r?t[e]:0;return Math.round((a+c)/be)}const pt={class:"thumbnail-container"},ft={class:"image-container size"},gt=["src","alt"],vt={class:"timestamp-overlay"},wt=R({__name:"CardThumbnail",props:{cardData:{type:Object,required:!0},baseImageUrl:{type:String,required:!0}},emits:["click"],setup(a){const t=a,e=t.cardData.text,r=t.cardData.season,c=t.cardData.episode,m=t.cardData.frame.start,f=t.cardData.frame.prefer,p=_(()=>Ce(r,c)),d=_(()=>Ie(m)),i=_(()=>Se(t.baseImageUrl,r,c,f));return(u,o)=>(I(),O("div",pt,[n(z,{class:"card size",color:"surface-variant",rounded:"lg",variant:"tonal",onClick:o[0]||(o[0]=w=>u.$emit("click"))},{default:l(()=>[k("div",ft,[k("img",{src:i.value,class:"size",alt:y(e)},null,8,gt),k("div",vt,A(p.value)+" "+A(d.value),1)]),n(oe,{class:"card-text text-center justify-center"},{default:l(()=>[V(A(y(e)),1)]),_:1})]),_:1})]))}}),Z=(a,t)=>{const e=a.__vccOpts||a;for(const[r,c]of t)e[r]=c;return e},yt=Z(wt,[["__scopeId","data-v-ecf2b807"]]);function ht(){let a=null;const t=()=>{if(a)return a;const c=document.createElement("canvas"),m=c.getContext("2d",{alpha:!1,willReadFrequently:!0});if(!m)throw new Error("Failed to get canvas context");return a={canvas:c,ctx:m},a};return{getContext:t,createPngBlob:c=>{const{canvas:m,ctx:f}=t();return m.width=c.width,m.height=c.height,f.drawImage(c,0,0),m.toDataURL("image/png")},cleanup:()=>{a&&(a.canvas.width=0,a.canvas.height=0,a=null)}}}function bt(a){const t=h([]),e=h([]),r=h({}),c=()=>{var s;return{timestamp:Date.now(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,platform:typeof navigator<"u"?navigator.platform:"unknown",screenResolution:typeof window<"u"?`${window.screen.width}x${window.screen.height}`:void 0,language:typeof navigator<"u"?navigator.language:"unknown",memoryUsage:(s=performance==null?void 0:performance.memory)==null?void 0:s.usedJSHeapSize}},m=s=>({path:(s==null?void 0:s.path)||window.location.pathname,lastAction:t.value[t.value.length-1],componentStack:[...e.value],lastStateChange:{...r.value}}),f=s=>{t.value=[...t.value.slice(-9),s]},p=(s,C)=>{if(C)e.value.push(s);else{const S=e.value.lastIndexOf(s);S!==-1&&e.value.splice(S,1)}},d=(s,C)=>{if(r.value[s]=C,Object.keys(r.value).length>10){const S=Object.keys(r.value);delete r.value[S[0]]}},i=s=>s instanceof TypeError||s instanceof ReferenceError?"critical":s.message.includes("network")||s.message.includes("fetch")?"high":s.message.includes("undefined")||s.message.includes("null")?"medium":"low",u=(s,C,S)=>({name:s.name,message:s.message,stack:s.stack,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,severity:i(s),systemInfo:c(),userContext:m(C),additionalInfo:S}),o=async(s,C,S)=>{var g;const b=u(typeof s=="string"?new Error(s):s,C,S),E=[`[${b.severity.toUpperCase()}] Error in ${a.context||"unknown context"}:`,`Time: ${new Date(b.systemInfo.timestamp).toISOString()}`,`Name: ${b.name}`,`Message: ${b.message}`,`Path: ${b.userContext.path}`,`Last Action: ${b.userContext.lastAction||"none"}`,`Component Stack: ${(g=b.userContext.componentStack)==null?void 0:g.join(" -> ")}`,b.userAgent?`UserAgent: ${b.userAgent}`:null,`System Info: ${JSON.stringify(b.systemInfo,null,2)}`,b.stack?`Stack: ${b.stack}`:null,b.additionalInfo?`Additional Info: ${JSON.stringify(b.additionalInfo,null,2)}`:null,b.userContext.lastStateChange?`Last State Changes: ${JSON.stringify(b.userContext.lastStateChange,null,2)}`:null].filter(Boolean).join(`

`),T=a.maxRetries||3;let x=0;for(;x<T;)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:E})});break}catch(U){if(x++,x===T){console.error("Failed to send error report after multiple retries:",U);const M=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");M.push({content:E,timestamp:Date.now()}),localStorage.setItem("failedErrorReports",JSON.stringify(M))}await new Promise(M=>setTimeout(M,1e3*x))}},w=s=>(C,S,b)=>o(C,S,{...b,context:s});return typeof window<"u"&&setInterval(async()=>{const s=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");if(s.length===0)return;const C=[];for(const S of s)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:S.content})})}catch{Date.now()-S.timestamp<24*60*60*1e3&&C.push(S)}localStorage.setItem("failedErrorReports",JSON.stringify(C))},30*60*1e3),{reportError:o,reportWithContext:w,trackAction:f,trackComponent:p,trackStateChange:d}}function xt(a){const t=ht(),e=bt({webhookUrl:a.webhookUrl,context:"ImageOperations"}),r=Me({isDownloading:!1,isCopying:!1,operationStatus:""}),c=u=>{const o=new Image;return o.crossOrigin="Anonymous",o.src=u,o},m=u=>new Promise((o,w)=>{const v=c(u);v.onload=()=>o(v),v.onerror=w}),f=(u,o)=>{if(r.isDownloading)return;e.trackAction(`download_image_start:${o}`),r.isDownloading=!0,r.operationStatus="下載中...";const w=c(u);w.onload=()=>{const v=t.createPngBlob(w),s=document.createElement("a");s.href=v,s.download=`${o}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s),r.operationStatus="下載完成",e.trackAction(`download_image_success:${o}`),r.isDownloading=!1},w.onerror=()=>{e.trackAction(`download_image_error:${o}`),e.reportError(new Error("Failed to load image"),void 0,{imageUrl:u,filename:o,operation:"download"}),r.operationStatus="下載失敗",r.isDownloading=!1}},p=async u=>{if(r.isCopying)return;e.trackAction("copy_image_start"),r.isCopying=!0,r.operationStatus="";const o=new Promise((w,v)=>{m(u).then(s=>{const S=t.createPngBlob(s).split(","),b=atob(S[1]),E=b.length,T=new Uint8Array(E);for(let x=0;x<E;x++)T[x]=b.charCodeAt(x);w(new Blob([T],{type:"image/png"}))}).catch(v)});try{const w=new ClipboardItem({"image/png":o});await navigator.clipboard.write([w]),r.operationStatus="圖片複製成功",e.trackAction("copy_image_success")}catch(w){throw e.trackAction("copy_image_error"),e.reportError(w,void 0,{imageUrl:u,operation:"copyImage",clipboardSupported:!!navigator.clipboard}),r.operationStatus="複製失敗，請稍後重試",w}finally{r.isCopying=!1}},d=async u=>{if(!r.isCopying){e.trackAction("copy_url_start"),r.isCopying=!0,r.operationStatus="";try{await navigator.clipboard.writeText(u),r.operationStatus="連結複製成功",e.trackAction("copy_url_success")}catch(o){throw e.trackAction("copy_url_error"),e.reportError(o,void 0,{url:u,operation:"copyUrl",clipboardSupported:!!navigator.clipboard}),r.operationStatus="複製失敗",o}finally{r.isCopying=!1}}},i=()=>{t.cleanup(),e.trackAction("image_operations_cleanup")};return e.trackComponent("ImageOperations",!0),{isDownloading:X(r,"isDownloading"),isCopying:X(r,"isCopying"),operationStatus:X(r,"operationStatus"),downloadImage:f,copyImage:p,copyUrl:d,cleanup:i}}const kt={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},St=R({__name:"ActionButtons",props:{cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},videoConfig:{type:Object,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["report","gif-create"],setup(a,{emit:t}){const e=a,r=t,c=q(),m=h(!1),f=xt({webhookUrl:e.webhookUrl}),p=h(!1);ae(()=>f.operationStatus.value,v=>{v&&(p.value=!0)});const d=_(()=>{const v=mt(e.cardData.frame.start,Xe,e.cardData.episode,e.cardData.season===F.MYGO);return ut(e.videoConfig,e.cardData.season,e.cardData.episode,v)}),i=()=>{f.downloadImage(e.imageUrl,e.cardData.text)},u=async()=>{if(m.value){m.value=!1;return}try{c.copyMode?await f.copyUrl(e.imageUrl):await f.copyImage(e.imageUrl)}catch{}},o=async()=>{try{m.value=!0,await f.copyUrl(e.imageUrl)}catch{}},w=()=>{r("gif-create")};return pe(()=>{m.value=!1}),(v,s)=>{const C=Fe("long-press");return I(),O(W,null,[n(N,null,{default:l(()=>[n(D,{onClick:s[0]||(s[0]=S=>v.$emit("report"))},{default:l(()=>[s[2]||(s[2]=V(" 回報 ")),fe(v.$slots,"report-dialog")]),_:3}),n(D,{onClick:i,loading:y(f).isDownloading.value},{default:l(()=>s[3]||(s[3]=[V("下載")])),_:1},8,["loading"]),n(D,{onClick:w,loading:a.isGifCreating},{default:l(()=>s[4]||(s[4]=[V("GIF")])),_:1},8,["loading"]),Re((I(),$(D,{onClick:u,loading:y(f).isCopying.value},{default:l(()=>s[5]||(s[5]=[V("複製")])),_:1},8,["loading"])),[[C,o]]),n(D,{href:d.value,target:"_blank"},{default:l(()=>s[6]||(s[6]=[V(" 從這裡開始看 ")])),_:1},8,["href"])]),_:3}),n(ne,{modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=S=>p.value=S),timeout:2e3,class:"text-center",rounded:"pill"},{default:l(()=>[k("div",kt,A(y(f).operationStatus),1)]),_:1},8,["modelValue"])],64)}}}),Ct={style:{position:"relative"}},It={class:"timestamp-overlay"},Vt=R({__name:"CardDialog",props:{show:{type:Boolean,required:!0},cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},videoConfig:{type:Object,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["update:show","report","gif-create"],setup(a){const t=a,e=t.cardData.text,r=t.cardData.season,c=t.cardData.episode,m=t.cardData.frame.start,f=_(()=>Ce(r,c)),p=_(()=>Ie(m));return(d,i)=>(I(),$(L,{"model-value":a.show,"onUpdate:modelValue":i[2]||(i[2]=u=>d.$emit("update:show",u)),"max-width":"600px",style:{maxHeight:"90vh"}},{default:l(()=>[n(z,null,{default:l(()=>[k("div",Ct,[n(we,{src:a.imageUrl,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),k("div",It,A(f.value)+" "+A(p.value),1)]),n(N,null,{default:l(()=>[n(j,null,{default:l(()=>[n(oe,{class:"text-center"},{default:l(()=>[V(A(y(e)),1)]),_:1})]),_:1})]),_:1}),n(H,null,{default:l(()=>[n(St,{"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":a.imageUrl,"video-config":a.videoConfig,"is-gif-creating":a.isGifCreating,onReport:i[0]||(i[0]=u=>d.$emit("report")),onGifCreate:i[1]||(i[1]=u=>d.$emit("gif-create"))},{"report-dialog":l(()=>[fe(d.$slots,"report-dialog",{},void 0,!0)]),_:3},8,["card-data","webhook-url","image-url","video-config","is-gif-creating"])]),_:3})]),_:3})]),_:3},8,["model-value"]))}}),Ut=Z(Vt,[["__scopeId","data-v-aaed478d"]]),$t={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},Dt="https://mypic.0m0.uk/images/",_t=R({__name:"GifDialog",props:{text:{},season:{},episode:{},frameStart:{},frameEnd:{}},setup(a,{expose:t}){const e=new at;let r=!1;const c=a,m=h(!1),f=h(!1),p=h(""),d=h(!1),i=h(!1),u=h(!1),o=h(""),w=h(null),v=h(null);async function s(){r||(await e.load(),r=!0)}async function C(){if(!w.value)return;const x=document.createElement("a");x.href=URL.createObjectURL(w.value),x.download=`${c.text}.gif`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(x.href)}async function S(){const x=new File([w.value],"download.gif",{type:"image/gif"}),g=new FormData;g.append("fileToUpload",x),g.append("reqtype","fileupload");const U=await fetch("https://cors.0m0.uk/?https://catbox.moe/user/api.php",{method:"POST",body:g});if(U.status===413)throw new Error("GIF檔案過大，請自行下載後上傳至其他圖床");return await U.text()}async function b(){if(!w.value)return;u.value=!0;const x=new ClipboardItem({"text/plain":(async()=>{try{if(v.value)return new Blob([v.value],{type:"text/plain"});p.value="正在上傳GIF...",f.value=!0;const g=await S();return v.value=g,new Blob([g],{type:"text/plain"})}catch(g){throw p.value=g instanceof Error?g.message:"GIF 上傳失敗",T(g),g}})()});try{await navigator.clipboard.write([x]),p.value="GIF 連結複製成功"}catch(g){g instanceof Error&&g.name==="NotAllowedError"?p.value="GIF 連結複製失敗":p.value=g instanceof Error?g.message:"GIF 上傳失敗",T(g)}finally{f.value=!0,u.value=!1}}async function E(){if(d.value)return;if(w.value){m.value=!0;return}v.value=null,d.value=!0,p.value="GIF生成中...",f.value=!0;const x=performance.now(),g=Array.from({length:c.frameEnd-c.frameStart-4},(U,M)=>c.frameStart+M+2);try{await s();const U=g.map(async re=>{const Ue=`${Dt}${c.season}/${c.episode}/${re}.webp`,$e=await tt(Ue);await e.writeFile(`${re}.webp`,$e)});await Promise.all(U),await e.exec(["-start_number",g[0].toString(),"-i","%d.webp","-vf","palettegen","palette.png"]),await e.exec(["-start_number",g[0].toString(),"-i","%d.webp","-i","palette.png","-filter_complex","paletteuse=dither=none","-frames:v",g.length.toString(),"-f","gif","-framerate","24","output.gif"]);const M=await e.readFile("output.gif");w.value=new Blob([M],{type:"image/gif"}),o.value=URL.createObjectURL(w.value);const Ve=((performance.now()-x)/1e3).toFixed(1);p.value=`GIF生成完成 (${Ve}秒)`,m.value=!0}catch(U){console.error("GIF generation failed:",U),T(U),p.value="GIF生成失敗"}finally{d.value=!1,f.value=!0;const U=g.map(M=>e.deleteFile(`${M}.webp`).catch(console.error));await Promise.all([...U,e.deleteFile("output.gif").catch(console.error),e.deleteFile("palette.png").catch(console.error)])}}async function T(x){const g={content:`Copy failed: ${x.name}

${navigator.userAgent}

${x.message}

${x.stack}`};try{await fetch(`https://discord.com/api/webhooks/${atob(Q.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})}catch(U){console.error("Failed to send error report to Discord:",U)}}return t({CreateGif:E,isGeneratingGif:d}),(x,g)=>(I(),O(W,null,[n(L,{modelValue:m.value,"onUpdate:modelValue":g[0]||(g[0]=U=>m.value=U),"max-width":"600px",style:{maxHeight:"90vh"}},{default:l(()=>[n(z,null,{default:l(()=>[n(we,{src:o.value,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),n(H,null,{default:l(()=>[n(N,null,{default:l(()=>[n(D,{onClick:C,loading:i.value},{default:l(()=>g[2]||(g[2]=[V("下載")])),_:1},8,["loading"]),n(D,{onClick:b,loading:u.value},{default:l(()=>g[3]||(g[3]=[V("生成連結")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(ne,{modelValue:f.value,"onUpdate:modelValue":g[1]||(g[1]=U=>f.value=U),timeout:2e3,class:"text-center",rounded:"pill"},{default:l(()=>[k("div",$t,A(p.value),1)]),_:1},8,["modelValue"])],64))}}),Mt=R({__name:"index",props:{styles:{type:Object,required:!0},cardData:{type:Object,required:!0},videoConfig:{type:Object,required:!0},webhookUrl:{type:String,required:!0},baseImageUrl:{type:String,default:"https://mypic.0m0.uk/images/"}},setup(a){const t=a,e=h(!1),r=h(null),c=_(()=>Se(t.baseImageUrl,t.cardData.season,t.cardData.episode,t.cardData.frame.prefer)),m=()=>{},f=async()=>{r.value&&await r.value.CreateGif()};return(p,d)=>{var i;return I(),O("div",{style:ge(a.styles)},[n(yt,{"card-data":a.cardData,"base-image-url":a.baseImageUrl,onClick:d[0]||(d[0]=u=>e.value=!0)},null,8,["card-data","base-image-url"]),n(Ut,{show:e.value,"onUpdate:show":d[1]||(d[1]=u=>e.value=u),"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":c.value,"video-config":a.videoConfig,onReport:m,onGifCreate:f,"is-gif-creating":(i=r.value)==null?void 0:i.isGeneratingGif},{"report-dialog":l(()=>[n(ke,{"file-name":c.value,text:a.cardData.text},null,8,["file-name","text"])]),_:1},8,["show","card-data","webhook-url","image-url","video-config","is-gif-creating"]),n(_t,{ref_key:"gifDialogRef",ref:r,text:a.cardData.text,season:a.cardData.season,episode:a.cardData.episode,"frame-start":a.cardData.frame.start,"frame-end":a.cardData.frame.end},null,8,["text","season","episode","frame-start","frame-end"])],4)}}}),Ft=R({__name:"ResultGrid",setup(a){const t=nt();q();const{filteredCards:e}=et(t),r=_(()=>`https://discord.com/api/webhooks/${atob(Q.webhook)}`);let c=h(24);const m=()=>{c.value=(1+Math.floor((window.innerWidth-320)/310))*8},f=_(()=>{typeof window<"u"&&window.scrollTo({top:0,left:0,behavior:"smooth"});const d=e.value;return(i,u)=>{const o=d.slice(i*u,(i+1)*u);return Promise.resolve(o)}}),p=d=>{var i;return(i=d.value)==null?void 0:i.segmentId};return me(()=>{m(),window.addEventListener("resize",m)}),pe(()=>{window.removeEventListener("resize",m)}),(d,i)=>(I(),$(Ae,null,{default:l(()=>[n(y(ot),{length:y(e).length?y(e).length:1,pageSize:y(c),pageProvider:f.value,"get-key":p,"page-provider-debounce-time":100,class:"grid ma-5"},{placeholder:l(({index:u,style:o})=>[k("div",{class:"item",style:ge(o)},A(y(e).length?"還在GO...":""),5)]),default:l(({item:u,style:o,index:w})=>[n(Mt,{styles:o,"card-data":u,"video-config":y(Q).videoLink,"webhook-url":r.value},null,8,["styles","card-data","video-config","webhook-url"])]),_:1},8,["length","pageSize","pageProvider"])]),fallback:l(()=>i[0]||(i[0]=[k("p",null,"Loading...",-1)])),_:1}))}}),Rt=Z(Ft,[["__scopeId","data-v-4e3feebf"]]),de=R({__name:"MultiSelect",props:Te({items:{type:Array,required:!0},label:{type:String,required:!1,default:"Select"}},{modelValue:{type:Array,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const t=a,e=Ee(a,"modelValue"),r=_(()=>e.value.length===t.items.length),c=_(()=>e.value.length>0&&e.value.length<t.items.length),m=()=>{r.value?e.value=[]:e.value=[...t.items]};return ae(e,()=>{e.value.sort()}),(f,p)=>(I(),$(Ye,{modelValue:e.value,"onUpdate:modelValue":p[0]||(p[0]=d=>e.value=d),label:a.label,variant:"outlined",multiple:"",items:a.items,style:{"min-width":"250px"}},{"prepend-item":l(()=>[n(P,{title:"全選",onClick:m},{prepend:l(()=>[n(Ne,{indeterminate:c.value,"model-value":r.value},null,8,["indeterminate","model-value"])]),_:1}),n(qe,{class:"mt-2"})]),selection:l(({item:d,index:i})=>[e.value.length!=a.items.length?(I(),$(se,{key:0},{default:l(()=>[k("span",null,A(d.value),1)]),_:2},1024)):ee("",!0),i===a.items.length-1?(I(),$(se,{key:1},{default:l(()=>p[1]||(p[1]=[k("span",null,"全選",-1)])),_:1})):ee("",!0)]),_:1},8,["modelValue","label","items"]))}}),At=R({__name:"FilterDialog",setup(a){const t=ye(),e=h(!1),r=h([]),c=h([]),m=h([]);ae(e,d=>{d&&(c.value=[...t.mygoEpisodes],m.value=[...t.avemujicaEpisodes])});const f=()=>{c.value=[],m.value=[],r.value=[]},p=()=>{t.mygoEpisodesBuffer=[...c.value],t.avemujicaEpisodesBuffer=[...m.value],t.characterIdBuffer=0,t.flush(),e.value=!1};return(d,i)=>(I(),$(L,{modelValue:e.value,"onUpdate:modelValue":i[2]||(i[2]=u=>e.value=u),"max-width":"600px",style:{"min-height":"600px"},transition:"dialog-top-transition"},{activator:l(({props:u})=>[n(Y,Oe(u,{icon:y(Qe)}),null,16,["icon"])]),default:l(()=>[n(z,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:l(()=>[i[3]||(i[3]=k("br",null,null,-1)),i[4]||(i[4]=k("br",null,null,-1)),i[5]||(i[5]=k("span",{class:"align-center"},"集數篩選",-1)),n(de,{items:y(ue)[y(F).MYGO],modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=u=>c.value=u),label:"MyGO",style:{"min-width":"250px"}},null,8,["items","modelValue"]),n(de,{items:y(ue)[y(F).AVE_MUJICA],modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=u=>m.value=u),label:"Ave Mujica",style:{"min-width":"250px"}},null,8,["items","modelValue"]),n(H,null,{default:l(()=>[n(D,{class:"text-center",text:"清除篩選",onClick:f}),n(D,{class:"text-center",text:"確定",onClick:p})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Tt=R({__name:"AppBarComponent",setup(a){const t=q(),e=he(),r=()=>{e.flush()},c=()=>{e.queryBuffer="",e.flush()};return(m,f)=>{const p=At;return I(),$(Je,{density:"prominent"},{default:l(()=>[n(ve,null,{default:l(()=>[f[1]||(f[1]=k("div",{class:"text-h5 mx-auto font-weight-bold text-center text-truncate"}," MyGO Mujica 截圖搜尋器 ",-1)),n(N,{dense:"",class:"mt-2"},{default:l(()=>[n(j,{class:"text-center"},{default:l(()=>[n(te,{modelValue:y(e).queryBuffer,"onUpdate:modelValue":f[0]||(f[0]=d=>y(e).queryBuffer=d),"single-line":"","hide-details":"",clearable:"",label:"搜尋",variant:"outlined",class:"short-search",onKeyup:Ge(r,["enter"]),"onClick:clear":c,autofocus:""},{append:l(()=>[n(Y,{onClick:y(t).toggleReverse,icon:y(t).isReversed?y(We):y(He)},null,8,["onClick","icon"])]),"append-inner":l(()=>[n(p)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Et={};function Ot(a,t){const e=Tt,r=Rt,c=it;return I(),O(W,null,[n(e),n(r),n(c,{style:{width:"100%"}})],64)}const ta=Z(Et,[["render",Ot]]);export{ta as default};
