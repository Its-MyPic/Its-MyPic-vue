var Me=Object.defineProperty;var $e=(a,t,e)=>t in a?Me(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var X=(a,t,e)=>$e(a,typeof t!="symbol"?t+"":t,e);import{r as w,d as M,k as F,D as O,B as C,G as W,Y as n,C as r,a6 as V,W as x,l as me,A as D,u as y,a8 as te,a1 as A,a as Fe,f as ee,w as oe,L as pe,a9 as Ae,y as Re,F as fe,I as ge,aa as Te,ab as Ee,ac as Oe,Z as Ge,ad as Pe}from"./@vue-C4KFEXdN.js";import{e as q,f as z,g as Be,h as ve,i as ae,j as H,k as U,l as ne,u as je,n as we,o as Y,p as j,q as ze,r as Le,s as J,t as B,v as N,w as re,x as Ne,y as ye,z as qe,A as se,B as Ye,C as Je,D as Qe}from"./vuetify-Clp1nhuV.js";import{m as P,a as ie,b as We,c as He,d as Ze}from"./@mdi-DKC2W5MC.js";import{u as Ke,a as he,b as be,S as R,n as Xe,c as Q,F as xe,M as et,E as ue}from"./app-BwbKfryI.js";import{d as ke,s as tt}from"./pinia-v6TATKJ3.js";import{f as at,F as ot}from"./@ffmpeg-B1ncfXmI.js";import{G as nt}from"./vue-virtual-scroll-grid-B032R7OG.js";import"./vite-ssg-s4Qwr7Yh.js";import"./@unhead-DUdWRP3r.js";import"./unhead-RKJfobys.js";import"./hookable-B8xFkYCm.js";import"./vue-router-DohIAVTx.js";import"./protobufjs-CgPuVhCO.js";import"./@protobufjs-f4nnaicZ.js";import"./opencc-js-kMbEc8rw.js";const L=ke("ui",()=>{const a=w(!1),t=w(!1),e=w(!1);return{isReversed:a,copyMode:t,wayBackMode:e,toggleReverse:()=>{a.value=!a.value},toggleCopyMode:()=>{t.value=!t.value},togglewayBackMode:()=>{e.value=!e.value}}});class ce{constructor(t){X(this,"cache");X(this,"capacity");if(t<=0)throw new Error("Cache capacity must be greater than 0");this.cache=new Map,this.capacity=t}has(t){return this.cache.has(t)}get(t){const e=this.cache.get(t);if(e)return this.cache.delete(t),this.cache.set(t,e),e}set(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.capacity){const o=this.cache.keys().next();o.done||this.cache.delete(o.value)}this.cache.set(t,e)}clear(){this.cache.clear()}get size(){return this.cache.size}get maxSize(){return this.capacity}keys(){return this.cache.keys()}values(){return this.cache.values()}entries(){return this.cache.entries()}}const lt=ke("results",()=>{const a=Ke(),t=he(),e=be(),o=L(),d=new ce(50),u=new ce(50),p=i=>{const m=Array.from(i.mygo).sort().join(","),l=Array.from(i.avemujica).sort().join(",");return`mygo:${m}|avemujica:${l}`},f=i=>{for(const m of i)m.text&&!m.normalizedText&&(m.normalizedText=Xe(m.text));return i};return{filteredCards:M(()=>{const i=a.cards;if(!i.length)return[];const m=f([...i]),l=t.activeFilters,h=p(l);let g;if(d.has(h)?g=d.get(h):(g=m.filter(s=>l.mygo.size&&s.season===R.MYGO?l.mygo.has(s.episode):l.avemujica.size&&s.season===R.AVE_MUJICA?l.avemujica.has(s.episode):l.mygo.size===0&&l.avemujica.size===0),d.set(h,g)),e.normalizedQuery){const s=`${h}:search:${e.normalizedQuery}`;if(u.has(s))g=u.get(s);else{const S=g.filter(k=>{var b;return(b=k.normalizedText)==null?void 0:b.includes(e.normalizedQuery)});u.set(s,S),g=S}}return o.isReversed?[...g].reverse():g})}}),rt="MTMzNTEwMzQ1NzY4MTczNTc2MC9LT0lwZ2FDc3RmRURnVHVqR2dEYmVYWWZSLUdZRjVQQ29veXZ0TFVGbFhFM0tYdGRGTzhHR3RrTXptWEp4R3FxQVI5bw==",st={MyGO:{1:"https://www.youtube.com/watch?v=WOrYBIYIwyk",2:"https://www.youtube.com/watch?v=WOrYBIYIwyk",3:"https://www.youtube.com/watch?v=WOrYBIYIwyk",4:"https://www.youtube.com/watch?v=ijdspfPMzYc",5:"https://www.youtube.com/watch?v=zfA0zRAkAdk",6:"https://www.youtube.com/watch?v=UwgyEoB9vU8",7:"https://www.youtube.com/watch?v=rlY2b3TIYPs",8:"https://www.youtube.com/watch?v=mfboDpl88QY",9:"https://www.youtube.com/watch?v=ySjYENzyZmY",10:"https://www.youtube.com/watch?v=bLWDIYpGcEI",11:"https://www.youtube.com/watch?v=gAFDVnhX24o",12:"https://www.youtube.com/watch?v=wei3payuSi8",13:"https://www.youtube.com/watch?v=uQ3_PvPCNnI"},"Ave Mujica":{1:"https://www.youtube.com/watch?v=dxmmSFQxWzM",2:"https://www.youtube.com/watch?v=Bzl61esi4qc",3:"https://www.youtube.com/watch?v=HagaJboujK4",4:"https://www.youtube.com/watch?v=Z6cOxtDsfNU",5:"https://www.youtube.com/watch?v=7D2uGv7aprQ",6:"https://www.youtube.com/watch?v=jQraN1emvLQ",7:"https://www.youtube.com/watch?v=RONGNWb7OpQ",8:"https://www.youtube.com/watch?v=uh9jUhVTS28",9:"https://www.youtube.com/watch?v=pGrI6hk0vBg",10:"https://www.youtube.com/watch?v=m9cjOcCKIyQ",11:"https://www.youtube.com/watch?v=Cfm8TWGkvYQ",12:"https://www.youtube.com/watch?v=UtSEFdDZZLw",13:"https://www.youtube.com/watch?v=3LLj3fTpRoM"}},Z={webhook:rt,videoLink:st},Se=F({__name:"ReportDialog",props:{fileName:{type:String,required:!1,default:""},text:{type:String,required:!1,default:""}},setup(a){const t=a,e=w(""),o=w(""),d=w(!1),u=w(!1);async function p(){let f="";if(e.value&&(f+=`問題: ${e.value}
`),o.value&&(f+=`聯絡方式: ${o.value}
`),t.fileName&&(f+=`檔案名稱: ${t.fileName}
`),t.text&&(f+=`文字: ${t.text}
`),f){const c={content:f};await fetch(`https://discord.com/api/webhooks/${atob(Z.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),d.value=!0}u.value=!1}return(f,c)=>(C(),O(W,null,[n(q,{modelValue:u.value,"onUpdate:modelValue":c[2]||(c[2]=i=>u.value=i),activator:"parent","max-width":"600px",style:{maxHeight:"90vh"},transition:"dialog-bottom-transition"},{default:r(()=>[n(z,null,{default:r(()=>[n(Be,null,{default:r(()=>c[4]||(c[4]=[V("回報問題")])),_:1,__:[4]}),n(ve,null,{default:r(()=>[n(ae,{label:"你遭遇到的問題(選填)",modelValue:e.value,"onUpdate:modelValue":c[0]||(c[0]=i=>e.value=i),outlined:""},null,8,["modelValue"]),n(ae,{label:"你的聯絡方式(選填)",modelValue:o.value,"onUpdate:modelValue":c[1]||(c[1]=i=>o.value=i),outlined:""},null,8,["modelValue"])]),_:1}),n(H,null,{default:r(()=>[n(U,{onClick:p},{default:r(()=>c[5]||(c[5]=[V("送出")])),_:1,__:[5]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(ne,{modelValue:d.value,"onUpdate:modelValue":c[3]||(c[3]=i=>d.value=i),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>c[6]||(c[6]=[x("div",{class:"text-h6 mx-auto font-weight-bold text-center text-truncate"}," 已回報問題 ",-1)])),_:1,__:[6]},8,["modelValue"])],64))}}),it={key:0,class:"ml-2 d-flex align-center"},ut=F({__name:"FooterComponent",setup(a){const t=L(),e=w(!0),o=M({get(){return u.global.current.value.dark},set(m){p(m)}}),d=M({get(){return t.copyMode},set(m){t.copyMode=m,localStorage.setItem("copyURLMode",m.toString())}}),u=je();function p(m){u.global.name.value=m?"dark":"light",localStorage.setItem("darkTheme",u.global.name.value)}const f=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("firefox"),c=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("mobile"),i=()=>!(f()&&c());return me(()=>{e.value=i(),e.value?localStorage.getItem("copyURLMode")?t.copyMode=localStorage.getItem("copyURLMode")==="true":t.copyMode=!1:t.copyMode=!0,localStorage.getItem("darkTheme")?u.global.name.value=localStorage.getItem("darkTheme")??"dark":window.matchMedia("(prefers-color-scheme: light)").matches&&(u.global.name.value="light")}),(m,l)=>{const h=Se;return C(),D(Ne,{app:""},{default:r(()=>[n(we,{fluid:"",style:{padding:"5px"}},{default:r(()=>[n(Y,null,{default:r(()=>[n(j,null,{default:r(()=>[n(U,{variant:"text",size:"small",class:"text-center"},{default:r(()=>[l[7]||(l[7]=V(" 其他連結 ")),n(ze,{activator:"parent",location:"center"},{default:r(()=>[n(Le,null,{default:r(()=>[n(J,{icon:`mdiSvg:${y(P)}`},null,8,["icon"]),(C(),D(B,{key:0,target:"_blank",value:0,"append-icon":y(P),href:"https://github.com/NightFeather0615/Its-MyPic-Android"},{default:r(()=>[n(N,null,{default:r(()=>l[2]||(l[2]=[V("Its-MyPic for Android")])),_:1,__:[2]})]),_:1},8,["append-icon"])),(C(),D(B,{key:1,target:"_blank",value:1,"append-icon":y(P),href:"https://github.com/Its-MyPic/PowerToys-Run-Its-MyPic"},{default:r(()=>[n(N,null,{default:r(()=>l[3]||(l[3]=[V("PowerToys-Run Plugin")])),_:1,__:[3]})]),_:1},8,["append-icon"])),(C(),D(B,{key:2,target:"_blank",value:2,"append-icon":y(P),href:"https://github.com/Its-MyPic/krunner-Its-MyPic"},{default:r(()=>[n(N,null,{default:r(()=>l[4]||(l[4]=[V("Krunner Plugin")])),_:1,__:[4]})]),_:1},8,["append-icon"])),(C(),D(B,{key:3,target:"_blank",value:3,"append-icon":y(P),href:"https://github.com/Its-MyPic/Its-MyPic-vue"},{default:r(()=>[n(N,null,{default:r(()=>l[5]||(l[5]=[V("這個網頁的原始碼")])),_:1,__:[5]})]),_:1},8,["append-icon"])),(C(),D(B,{key:4,target:"_blank",value:4,"append-icon":y(P),href:"https://github.com/Its-MyPic/Its-MyPicDB"},{default:r(()=>[n(N,null,{default:r(()=>l[6]||(l[6]=[V("mygo系列的截圖資料")])),_:1,__:[6]})]),_:1},8,["append-icon"]))]),_:1})]),_:1})]),_:1,__:[7]}),n(U,{variant:"text",size:"small",class:"text-center"},{default:r(()=>[l[8]||(l[8]=V(" 回報問題 ")),n(h)]),_:1,__:[8]}),n(U,{variant:"text",size:"small",class:"text-center",href:"https://forms.gle/WzW9PZwUU6gqHZko7",target:"_blank"},{default:r(()=>l[9]||(l[9]=[V(" 投稿 ")])),_:1,__:[9]})]),_:1}),n(j,{cols:"1"},{default:r(()=>[n(U,{variant:"text",size:"small",density:"comfortable",icon:y(ie)},{default:r(()=>[n(J,{icon:y(ie),"aria-label":"設定"},null,8,["icon"]),n(q,{activator:"parent","max-width":"600px",style:{maxHeight:"90vh",minHeight:"200px"}},{default:r(()=>[n(z,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:r(()=>[l[14]||(l[14]=x("br",null,null,-1)),l[15]||(l[15]=x("span",{class:"ml-2 d-flex align-center"},"主題",-1)),n(j,{cols:"auto",class:"d-flex align-center"},{default:r(()=>[l[10]||(l[10]=x("span",{class:"mr-2 d-flex align-center"},"淺色",-1)),n(re,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=g=>o.value=g),class:"mx-2 d-flex align-center"},null,8,["modelValue"]),l[11]||(l[11]=x("span",{class:"ml-2 d-flex align-center"},"深色",-1))]),_:1,__:[10,11]}),l[16]||(l[16]=x("br",null,null,-1)),l[17]||(l[17]=x("span",{class:"ml-2 d-flex align-center"},"偏好複製模式",-1)),n(j,{cols:"auto",class:"d-flex align-center"},{default:r(()=>[l[12]||(l[12]=x("span",{class:"mr-2 d-flex align-center"},"複製圖片",-1)),n(re,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=g=>d.value=g),class:"mx-2 d-flex align-center",disabled:!e.value},null,8,["modelValue","disabled"]),l[13]||(l[13]=x("span",{class:"ml-2 d-flex align-center"},"複製連結",-1))]),_:1,__:[12,13]}),e.value?te("",!0):(C(),O("span",it,"您的瀏覽器不支援複製圖片")),l[18]||(l[18]=x("br",null,null,-1))]),_:1,__:[14,15,16,17,18]})]),_:1})]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}});function _e(a,t,e,o,d=!1){return`${a}${t}/${e}/${o}.webp${d?"?old":""}`}function ct(a,t,e){const o=a===R.AVE_MUJICA?Q[R.AVE_MUJICA]:Q[R.MYGO];var d=Z.videoLink;const u=String(t);return`${d[o][u]}&t=${e}s`}function Ce(a,t){return`${a===R.AVE_MUJICA?Q[R.AVE_MUJICA]:Q[R.MYGO]} 第${t}話`}function dt(a){const t=a/xe;return{minutes:Math.floor(t/60),seconds:Math.floor(t%60),totalSeconds:Math.round(t)}}function mt(a){return`${a.minutes}:${String(a.seconds).padStart(2,"0")}`}function Ie(a){const t=dt(a);return mt(t)}function pt(a,t,e,o){const d=o?t[e]:0;return Math.round((a+d)/xe)}const ft=["src","alt"],gt={class:"timestamp-overlay"},vt={class:"card-text text-center justify-center"},wt=F({__name:"CardThumbnail",props:{cardData:{type:Object,required:!0},imageUrl:{type:String,required:!0}},emits:["click"],setup(a){const t=a,e=t.cardData.text,o=t.cardData.season,d=t.cardData.episode,u=t.cardData.frame.start;t.cardData.frame.prefer;const p=M(()=>Ce(o,d)),f=M(()=>Ie(u));return(c,i)=>(C(),O("div",null,[n(z,{class:"card-size",color:"surface-variant",rounded:"lg",variant:"tonal",onClick:i[0]||(i[0]=m=>c.$emit("click"))},{default:r(()=>[x("img",{src:t.imageUrl,class:"img-size",alt:y(e)},null,8,ft),x("div",gt,A(p.value)+" "+A(f.value),1),x("div",vt,A(y(e)),1)]),_:1})]))}}),K=(a,t)=>{const e=a.__vccOpts||a;for(const[o,d]of t)e[o]=d;return e},yt=K(wt,[["__scopeId","data-v-20b0d884"]]);function ht(){let a=null;const t=()=>{if(a)return a;const d=document.createElement("canvas"),u=d.getContext("2d",{alpha:!1,willReadFrequently:!0});if(!u)throw new Error("Failed to get canvas context");return a={canvas:d,ctx:u},a};return{getContext:t,createPngBlob:d=>{const{canvas:u,ctx:p}=t();return u.width=d.width,u.height=d.height,p.drawImage(d,0,0),u.toDataURL("image/png")},cleanup:()=>{a&&(a.canvas.width=0,a.canvas.height=0,a=null)}}}function bt(a){const t=w([]),e=w([]),o=w({}),d=()=>{var s;return{timestamp:Date.now(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,platform:typeof navigator<"u"?navigator.platform:"unknown",screenResolution:typeof window<"u"?`${window.screen.width}x${window.screen.height}`:void 0,language:typeof navigator<"u"?navigator.language:"unknown",memoryUsage:(s=performance==null?void 0:performance.memory)==null?void 0:s.usedJSHeapSize}},u=s=>({path:(s==null?void 0:s.path)||window.location.pathname,lastAction:t.value[t.value.length-1],componentStack:[...e.value],lastStateChange:{...o.value}}),p=s=>{t.value=[...t.value.slice(-9),s]},f=(s,S)=>{if(S)e.value.push(s);else{const k=e.value.lastIndexOf(s);k!==-1&&e.value.splice(k,1)}},c=(s,S)=>{if(o.value[s]=S,Object.keys(o.value).length>10){const k=Object.keys(o.value);delete o.value[k[0]]}},i=s=>s instanceof TypeError||s instanceof ReferenceError?"critical":s.message.includes("network")||s.message.includes("fetch")?"high":s.message.includes("undefined")||s.message.includes("null")?"medium":"low",m=(s,S,k)=>({name:s.name,message:s.message,stack:s.stack,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,severity:i(s),systemInfo:d(),userContext:u(S),additionalInfo:k}),l=async(s,S,k)=>{var I;const b=m(typeof s=="string"?new Error(s):s,S,k),T=[`[${b.severity.toUpperCase()}] Error in ${a.context||"unknown context"}:`,`Time: ${new Date(b.systemInfo.timestamp).toISOString()}`,`Name: ${b.name}`,`Message: ${b.message}`,`Path: ${b.userContext.path}`,`Last Action: ${b.userContext.lastAction||"none"}`,`Component Stack: ${(I=b.userContext.componentStack)==null?void 0:I.join(" -> ")}`,b.userAgent?`UserAgent: ${b.userAgent}`:null,`System Info: ${JSON.stringify(b.systemInfo,null,2)}`,b.stack?`Stack: ${b.stack}`:null,b.additionalInfo?`Additional Info: ${JSON.stringify(b.additionalInfo,null,2)}`:null,b.userContext.lastStateChange?`Last State Changes: ${JSON.stringify(b.userContext.lastStateChange,null,2)}`:null].filter(Boolean).join(`

`),E=a.maxRetries||3;let $=0;for(;$<E;)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:T})});break}catch(v){if($++,$===E){console.error("Failed to send error report after multiple retries:",v);const _=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");_.push({content:T,timestamp:Date.now()}),localStorage.setItem("failedErrorReports",JSON.stringify(_))}await new Promise(_=>setTimeout(_,1e3*$))}},h=s=>(S,k,b)=>l(S,k,{...b,context:s});return typeof window<"u"&&setInterval(async()=>{const s=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");if(s.length===0)return;const S=[];for(const k of s)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:k.content})})}catch{Date.now()-k.timestamp<24*60*60*1e3&&S.push(k)}localStorage.setItem("failedErrorReports",JSON.stringify(S))},30*60*1e3),{reportError:l,reportWithContext:h,trackAction:p,trackComponent:f,trackStateChange:c}}function xt(a){const t=ht(),e=bt({webhookUrl:a.webhookUrl,context:"ImageOperations"}),o=Fe({isDownloading:!1,isCopying:!1,operationStatus:""}),d=m=>{const l=new Image;return l.crossOrigin="Anonymous",l.src=m,l},u=m=>new Promise((l,h)=>{const g=d(m);g.onload=()=>l(g),g.onerror=h}),p=(m,l)=>{if(o.isDownloading)return;e.trackAction(`download_image_start:${l}`),o.isDownloading=!0,o.operationStatus="下載中...";const h=d(m);h.onload=()=>{const g=t.createPngBlob(h),s=document.createElement("a");s.href=g,s.download=`${l}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s),o.operationStatus="下載完成",e.trackAction(`download_image_success:${l}`),o.isDownloading=!1},h.onerror=()=>{e.trackAction(`download_image_error:${l}`),e.reportError(new Error("Failed to load image"),void 0,{imageUrl:m,filename:l,operation:"download"}),o.operationStatus="下載失敗",o.isDownloading=!1}},f=async m=>{if(o.isCopying)return;e.trackAction("copy_image_start"),o.isCopying=!0,o.operationStatus="";const l=new Promise((h,g)=>{u(m).then(s=>{const k=t.createPngBlob(s).split(","),b=atob(k[1]),T=b.length,E=new Uint8Array(T);for(let $=0;$<T;$++)E[$]=b.charCodeAt($);h(new Blob([E],{type:"image/png"}))}).catch(g)});try{const h=new ClipboardItem({"image/png":l});await navigator.clipboard.write([h]),o.operationStatus="圖片複製成功",e.trackAction("copy_image_success")}catch(h){throw e.trackAction("copy_image_error"),e.reportError(h,void 0,{imageUrl:m,operation:"copyImage",clipboardSupported:!!navigator.clipboard}),o.operationStatus="複製失敗，請稍後重試",h}finally{o.isCopying=!1}},c=async m=>{if(!o.isCopying){e.trackAction("copy_url_start"),o.isCopying=!0,o.operationStatus="";try{await navigator.clipboard.writeText(m),o.operationStatus="連結複製成功",e.trackAction("copy_url_success")}catch(l){throw e.trackAction("copy_url_error"),e.reportError(l,void 0,{url:m,operation:"copyUrl",clipboardSupported:!!navigator.clipboard}),o.operationStatus="複製失敗",l}finally{o.isCopying=!1}}},i=()=>{t.cleanup(),e.trackAction("image_operations_cleanup")};return e.trackComponent("ImageOperations",!0),{isDownloading:ee(o,"isDownloading"),isCopying:ee(o,"isCopying"),operationStatus:ee(o,"operationStatus"),downloadImage:p,copyImage:f,copyUrl:c,cleanup:i}}const kt={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},St=F({__name:"ActionButtons",props:{cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["gif-create"],setup(a,{emit:t}){const e=a,o=t,d=L(),u=w(!1),p=xt({webhookUrl:e.webhookUrl}),f=w(!1);oe(()=>p.operationStatus.value,g=>{g&&(f.value=!0)});const c=M(()=>{const g=pt(e.cardData.frame.start,et,e.cardData.episode,e.cardData.season===R.MYGO);return ct(e.cardData.season,e.cardData.episode,g)}),i=()=>{p.downloadImage(e.imageUrl,e.cardData.text)},m=async()=>{if(u.value){u.value=!1;return}try{d.copyMode?await p.copyUrl(e.imageUrl):await p.copyImage(e.imageUrl)}catch{}},l=async()=>{try{u.value=!0,await p.copyUrl(e.imageUrl)}catch{}},h=()=>{o("gif-create")};return pe(()=>{u.value=!1}),(g,s)=>{const S=Ae("long-press");return C(),O(W,null,[n(Y,null,{default:r(()=>[n(U,null,{default:r(()=>[s[1]||(s[1]=V(" 回報 ")),fe(g.$slots,"report-dialog")]),_:3,__:[1]}),n(U,{onClick:i,loading:y(p).isDownloading.value},{default:r(()=>s[2]||(s[2]=[V("下載")])),_:1,__:[2]},8,["loading"]),n(U,{onClick:h,loading:a.isGifCreating},{default:r(()=>s[3]||(s[3]=[V("GIF")])),_:1,__:[3]},8,["loading"]),Re((C(),D(U,{onClick:m,loading:y(p).isCopying.value},{default:r(()=>s[4]||(s[4]=[V("複製")])),_:1,__:[4]},8,["loading"])),[[S,l]]),n(U,{href:c.value,target:"_blank"},{default:r(()=>s[5]||(s[5]=[V(" 從這裡開始看 ")])),_:1,__:[5]},8,["href"])]),_:3}),n(ne,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=k=>f.value=k),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>[x("div",kt,A(y(p).operationStatus),1)]),_:1},8,["modelValue"])],64)}}}),_t={style:{position:"relative"}},Ct={class:"timestamp-overlay"},It=F({__name:"CardDialog",props:{show:{type:Boolean,required:!0},cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["update:show","gif-create"],setup(a){const t=a,e=t.cardData.text,o=t.cardData.season,d=t.cardData.episode,u=t.cardData.frame.start,p=M(()=>Ce(o,d)),f=M(()=>Ie(u));return(c,i)=>(C(),D(q,{"model-value":a.show,"onUpdate:modelValue":i[1]||(i[1]=m=>c.$emit("update:show",m)),"max-width":"600px",style:{maxHeight:"90vh"}},{default:r(()=>[n(z,null,{default:r(()=>[x("div",_t,[n(ye,{src:a.imageUrl,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),x("div",Ct,A(p.value)+" "+A(f.value),1)]),n(Y,null,{default:r(()=>[n(j,null,{default:r(()=>[n(ve,{class:"text-center"},{default:r(()=>[V(A(y(e)),1)]),_:1})]),_:1})]),_:1}),n(H,null,{default:r(()=>[n(St,{"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":a.imageUrl,"is-gif-creating":a.isGifCreating,onGifCreate:i[0]||(i[0]=m=>c.$emit("gif-create"))},{"report-dialog":r(()=>[fe(c.$slots,"report-dialog",{},void 0,!0)]),_:3},8,["card-data","webhook-url","image-url","is-gif-creating"])]),_:3})]),_:3})]),_:3},8,["model-value"]))}}),Vt=K(It,[["__scopeId","data-v-5cf36450"]]),Ut={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},Dt="https://mypic.0m0.uk/images/",Mt=F({__name:"GifDialog",props:{text:{},season:{},episode:{},frameStart:{},frameEnd:{}},setup(a,{expose:t}){const e=L(),o=new ot;let d=!1;const u=a,p=w(!1),f=w(!1),c=w(""),i=w(!1),m=w(!1),l=w(!1),h=w(""),g=w(null),s=w(null);async function S(){d||(await o.load(),d=!0)}async function k(){if(!g.value)return;const I=document.createElement("a");I.href=URL.createObjectURL(g.value),I.download=`${u.text}.gif`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(I.href)}async function b(){const I=new File([g.value],"download.gif",{type:"image/gif"}),v=new FormData;v.append("fileToUpload",I),v.append("reqtype","fileupload");const _=await fetch("https://cors.0m0.uk/?https://catbox.moe/user/api.php",{method:"POST",body:v});if(_.status===412)throw new Error("GIF檔案過大，請自行下載後上傳至其他圖床");return await _.text()}async function T(){if(!g.value)return;l.value=!0;const I=new ClipboardItem({"text/plain":(async()=>{if(s.value)return new Blob([s.value],{type:"text/plain"});c.value="正在上傳GIF...",f.value=!0;const v=await b();return s.value=v,new Blob([v],{type:"text/plain"})})()});try{await navigator.clipboard.write([I]),c.value="GIF 連結複製成功"}catch(v){v instanceof Error&&v.name==="NotAllowedError"?c.value="GIF 連結複製失敗":c.value=v instanceof Error?v.message:"GIF 上傳失敗",$(v)}finally{f.value=!0,l.value=!1}}async function E(){if(i.value)return;if(g.value){p.value=!0;return}s.value=null,i.value=!0,c.value="GIF生成中...",f.value=!0;const I=performance.now(),v=Array.from({length:u.frameEnd-u.frameStart-4},(_,G)=>u.frameStart+G+2);try{await S();const _=v.map(async le=>{const Ue=_e(Dt,u.season,u.episode,le,e.wayBackMode),De=await at(Ue);await o.writeFile(`${le}.webp`,De)});await Promise.all(_),await o.exec(["-start_number",v[0].toString(),"-i","%d.webp","-vf","palettegen","palette.png"]),await o.exec(["-start_number",v[0].toString(),"-i","%d.webp","-i","palette.png","-filter_complex","paletteuse=dither=none","-frames:v",v.length.toString(),"-f","gif","-framerate","24","output.gif"]);const G=await o.readFile("output.gif");g.value=new Blob([G],{type:"image/gif"}),h.value=URL.createObjectURL(g.value);const Ve=((performance.now()-I)/1e3).toFixed(1);c.value=`GIF生成完成 (${Ve}秒)`,p.value=!0}catch(_){console.error("GIF generation failed:",_),$(_),c.value="GIF生成失敗"}finally{i.value=!1,f.value=!0;const _=v.map(G=>o.deleteFile(`${G}.webp`).catch(console.error));await Promise.all([..._,o.deleteFile("output.gif").catch(console.error),o.deleteFile("palette.png").catch(console.error)])}}async function $(I){const v={content:`Copy failed: ${I.name}

${navigator.userAgent}

${I.message}

${I.stack}`};try{await fetch(`https://discord.com/api/webhooks/${atob(Z.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)})}catch(_){console.error("Failed to send error report to Discord:",_)}}return t({CreateGif:E,isGeneratingGif:i}),(I,v)=>(C(),O(W,null,[n(q,{modelValue:p.value,"onUpdate:modelValue":v[0]||(v[0]=_=>p.value=_),"max-width":"600px",style:{maxHeight:"90vh"}},{default:r(()=>[n(z,null,{default:r(()=>[n(ye,{src:h.value,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),n(H,null,{default:r(()=>[n(Y,null,{default:r(()=>[n(U,{onClick:k,loading:m.value},{default:r(()=>v[2]||(v[2]=[V("下載")])),_:1,__:[2]},8,["loading"]),n(U,{onClick:T,loading:l.value},{default:r(()=>v[3]||(v[3]=[V("生成連結")])),_:1,__:[3]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(ne,{modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=_=>f.value=_),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>[x("div",Ut,A(c.value),1)]),_:1},8,["modelValue"])],64))}}),$t=F({__name:"index",props:{styles:{type:Object,required:!0},cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},baseImageUrl:{type:String,default:"https://mypic.0m0.uk/images/"}},setup(a){const t=a,e=L(),o=w(!1),d=w(null),u=M(()=>_e(t.baseImageUrl,t.cardData.season,t.cardData.episode,t.cardData.frame.prefer,e.wayBackMode)),p=async()=>{d.value&&await d.value.CreateGif()};return(f,c)=>{var i;return C(),O("div",{style:ge(a.styles)},[n(yt,{"card-data":a.cardData,"image-url":u.value,onClick:c[0]||(c[0]=m=>o.value=!0)},null,8,["card-data","image-url"]),n(Vt,{show:o.value,"onUpdate:show":c[1]||(c[1]=m=>o.value=m),"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":u.value,onGifCreate:p,"is-gif-creating":(i=d.value)==null?void 0:i.isGeneratingGif},{"report-dialog":r(()=>[n(Se,{"file-name":u.value,text:a.cardData.text},null,8,["file-name","text"])]),_:1},8,["show","card-data","webhook-url","image-url","is-gif-creating"]),n(Mt,{ref_key:"gifDialogRef",ref:d,text:a.cardData.text,season:a.cardData.season,episode:a.cardData.episode,"frame-start":a.cardData.frame.start,"frame-end":a.cardData.frame.end},null,8,["text","season","episode","frame-start","frame-end"])],4)}}}),Ft=F({__name:"ResultGrid",setup(a){const t=lt(),{filteredCards:e}=tt(t),o=M(()=>`https://discord.com/api/webhooks/${atob(Z.webhook)}`);let d=w(24);const u=()=>{var c=Math.max(0,window.innerWidth-290),i=Math.floor(c/270)+1;d.value=i*8},p=M(()=>{typeof window<"u"&&window.scrollTo({top:0,left:0,behavior:"smooth"});const c=e.value;return(i,m)=>{const l=c.slice(i*m,(i+1)*m);return Promise.resolve(l)}}),f=c=>{var i;return(i=c.value)==null?void 0:i.segmentId};return me(()=>{u(),window.addEventListener("resize",u)}),pe(()=>{window.removeEventListener("resize",u)}),(c,i)=>(C(),D(Te,null,{default:r(()=>[n(y(nt),{length:y(e).length?y(e).length:1,pageSize:y(d),pageProvider:p.value,"get-key":f,class:"grid ma-5"},{probe:r(()=>i[0]||(i[0]=[x("div",{class:"card-size"},"Probe",-1)])),placeholder:r(({index:m,style:l})=>[x("div",{class:"card-size",style:ge(l)},A(y(e).length?"還在GO...":""),5)]),default:r(({item:m,style:l,index:h})=>[n($t,{styles:l,"card-data":m,"webhook-url":o.value},null,8,["styles","card-data","webhook-url"])]),_:1},8,["length","pageSize","pageProvider"])]),fallback:r(()=>i[1]||(i[1]=[x("p",null,"Loading...",-1)])),_:1}))}}),At=K(Ft,[["__scopeId","data-v-0fa41b50"]]),de=F({__name:"MultiSelect",props:Ee({items:{type:Array,required:!0},label:{type:String,required:!1,default:"Select"}},{modelValue:{type:Array,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const t=a,e=Oe(a,"modelValue"),o=M(()=>e.value.length===t.items.length),d=M(()=>e.value.length>0&&e.value.length<t.items.length),u=()=>{o.value?e.value=[]:e.value=[...t.items]};return oe(e,()=>{e.value.sort()}),(p,f)=>(C(),D(qe,{modelValue:e.value,"onUpdate:modelValue":f[0]||(f[0]=c=>e.value=c),label:a.label,variant:"outlined",multiple:"",items:a.items,style:{"min-width":"250px"}},{"prepend-item":r(()=>[n(B,{title:"全選",onClick:u},{prepend:r(()=>[n(Ye,{indeterminate:d.value,"model-value":o.value},null,8,["indeterminate","model-value"])]),_:1}),n(Je,{class:"mt-2"})]),selection:r(({item:c,index:i})=>[e.value.length!=a.items.length?(C(),D(se,{key:0},{default:r(()=>[x("span",null,A(c.value),1)]),_:2},1024)):te("",!0),i===a.items.length-1?(C(),D(se,{key:1},{default:r(()=>f[1]||(f[1]=[x("span",null,"全選",-1)])),_:1,__:[1]})):te("",!0)]),_:1},8,["modelValue","label","items"]))}}),Rt=F({__name:"FilterDialog",setup(a){const t=he(),e=w(!1),o=w([]),d=w([]),u=w([]);oe(e,c=>{c&&(d.value=[...t.mygoEpisodes],u.value=[...t.avemujicaEpisodes])});const p=()=>{d.value=[],u.value=[],o.value=[]},f=()=>{t.mygoEpisodesBuffer=[...d.value],t.avemujicaEpisodesBuffer=[...u.value],t.characterIdBuffer=0,t.flush(),e.value=!1};return(c,i)=>(C(),D(q,{modelValue:e.value,"onUpdate:modelValue":i[2]||(i[2]=m=>e.value=m),"max-width":"600px",style:{"min-height":"600px"},transition:"dialog-top-transition"},{activator:r(({props:m})=>[n(J,Ge(m,{icon:y(We)}),null,16,["icon"])]),default:r(()=>[n(z,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:r(()=>[i[3]||(i[3]=x("br",null,null,-1)),i[4]||(i[4]=x("br",null,null,-1)),i[5]||(i[5]=x("span",{class:"align-center"},"集數篩選",-1)),n(de,{items:y(ue),modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=m=>d.value=m),label:"MyGO",style:{"min-width":"250px"}},null,8,["items","modelValue"]),n(de,{items:y(ue),modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=m=>u.value=m),label:"Ave Mujica",style:{"min-width":"250px"}},null,8,["items","modelValue"]),n(H,null,{default:r(()=>[n(U,{class:"text-center",text:"清除篩選",onClick:p}),n(U,{class:"text-center",text:"確定",onClick:f})]),_:1})]),_:1,__:[3,4,5]})]),_:1},8,["modelValue"]))}}),Tt=F({__name:"AppBarComponent",setup(a){const t=L(),e=be(),o=()=>{e.flush()},d=()=>{e.queryBuffer="",e.flush()};return(u,p)=>{const f=Rt;return C(),D(Qe,{density:"prominent"},{default:r(()=>[n(we,null,{default:r(()=>[p[1]||(p[1]=x("div",{class:"text-h5 mx-auto font-weight-bold text-center text-truncate"}," MyGO Mujica 截圖搜尋器 ",-1)),n(Y,{dense:"",class:"mt-2"},{default:r(()=>[n(j,{class:"text-center"},{default:r(()=>[n(ae,{modelValue:y(e).queryBuffer,"onUpdate:modelValue":p[0]||(p[0]=c=>y(e).queryBuffer=c),"single-line":"","hide-details":"",clearable:"",label:"搜尋",variant:"outlined",class:"short-search",onKeyup:Pe(o,["enter"]),"onClick:clear":d,autofocus:""},{append:r(()=>[n(J,{onClick:y(t).toggleReverse,icon:y(t).isReversed?y(He):y(Ze)},null,8,["onClick","icon"]),n(U,{text:"時光機",onClick:y(t).togglewayBackMode},null,8,["onClick"])]),"append-inner":r(()=>[n(f)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1,__:[1]})]),_:1})}}}),Et={};function Ot(a,t){const e=Tt,o=At,d=ut;return C(),O(W,null,[n(e),n(o),n(d,{style:{width:"100%"}})],64)}const ta=K(Et,[["render",Ot]]);export{ta as default};
