var De=Object.defineProperty;var Me=(a,e,t)=>e in a?De(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var H=(a,e,t)=>Me(a,typeof e!="symbol"?e+"":e,t);import{r as v,c as I,k as D,D as b,I as R,X as o,F as l,a5 as S,a7 as w,J as Y,l as Q,E as V,u as g,a8 as K,$ as F,f as $e,b as Z,w as ue,O as ce,a2 as Fe,H as de,B as Re,L as me,a9 as _e,aa as Ee,ab as Ge,Y as Te,ac as Ae}from"./@vue-D9bH4lrz.js";import{e as O,f as Oe,g as ee,h as X,i as W,j as U,k as j,l as te,u as Pe,n as je,o as L,p as A,q as Le,r as qe,s as z,t as T,v as P,w as ne,x as pe,y as fe,z as ze,A as Be,B as le,C as Ne,D as Ye}from"./vuetify-LsV7B-xS.js";import{m as G,a as re,b as Qe,c as We,d as Je}from"./@mdi-DKC2W5MC.js";import{u as He,a as ge,b as ve,S as M,n as Ze,c as B,F as we,M as Ke,E as se,d as Xe}from"./app-CqxfkAPN.js";import{d as ye,s as et}from"./pinia-B-uPeou1.js";import{f as tt,F as at}from"./@ffmpeg-B1ncfXmI.js";import{G as ot}from"./vue-virtual-scroll-grid-DSIWnnUt.js";import"./vite-ssg-CQCaBNHx.js";import"./vue-router-Y811DZoV.js";import"./@unhead-DsvcCsHo.js";import"./unhead-CpyiRjm1.js";import"./hookable-B7_1qfUG.js";import"./protobufjs-CgPuVhCO.js";import"./@protobufjs-f4nnaicZ.js";import"./opencc-js-D-mJJ3do.js";const q=ye("ui",()=>{const a=v(!1),e=v(!1);return{isReversed:a,copyMode:e,toggleReverse:()=>{a.value=!a.value},toggleCopyMode:()=>{e.value=!e.value}}});class nt{constructor(e){H(this,"cache");H(this,"capacity");this.cache=new Map,this.capacity=e}has(e){return this.cache.has(e)}get(e){const t=this.cache.get(e);if(t)return this.cache.delete(e),this.cache.set(e,t),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){const n=this.cache.keys().next();n.done||this.cache.delete(n.value)}this.cache.set(e,t)}clear(){this.cache.clear()}}const lt=ye("results",()=>{const a=He(),e=ge(),t=ve(),n=q(),r=new nt(50);return{filteredCards:I(()=>{const m=a.cards;if(!m.length)return[];const p=e.activeFilters,u=JSON.stringify({mygo:Array.from(p.mygo),avemujica:Array.from(p.avemujica)});let i;return r.has(u)?i=r.get(u):(i=m.filter(s=>p.mygo.size&&s.season===M.MYGO?p.mygo.has(s.episode):p.avemujica.size&&s.season===M.AVE_MUJICA?p.avemujica.has(s.episode):p.mygo.size===0&&p.avemujica.size===0),r.set(u,i)),t.normalizedQuery&&(i=i.filter(s=>Ze(s.text).includes(t.normalizedQuery))),n.isReversed?[...i].reverse():i})}}),rt="MTMzNTEwMzQ1NzY4MTczNTc2MC9LT0lwZ2FDc3RmRURnVHVqR2dEYmVYWWZSLUdZRjVQQ29veXZ0TFVGbFhFM0tYdGRGTzhHR3RrTXptWEp4R3FxQVI5bw==",st={MyGO:{1:"https://www.youtube.com/watch?v=WOrYBIYIwyk",2:"https://www.youtube.com/watch?v=WOrYBIYIwyk",3:"https://www.youtube.com/watch?v=WOrYBIYIwyk",4:"https://www.youtube.com/watch?v=ijdspfPMzYc",5:"https://www.youtube.com/watch?v=zfA0zRAkAdk",6:"https://www.youtube.com/watch?v=UwgyEoB9vU8",7:"https://www.youtube.com/watch?v=rlY2b3TIYPs",8:"https://www.youtube.com/watch?v=mfboDpl88QY",9:"https://www.youtube.com/watch?v=ySjYENzyZmY",10:"https://www.youtube.com/watch?v=bLWDIYpGcEI",11:"https://www.youtube.com/watch?v=gAFDVnhX24o",12:"https://www.youtube.com/watch?v=wei3payuSi8",13:"https://www.youtube.com/watch?v=uQ3_PvPCNnI"},"Ave Mujica":{1:"https://www.youtube.com/watch?v=dxmmSFQxWzM",2:"https://www.youtube.com/watch?v=Bzl61esi4qc",3:"https://www.youtube.com/watch?v=HagaJboujK4",4:"https://www.youtube.com/watch?v=Z6cOxtDsfNU",5:"https://www.youtube.com/watch?v=7D2uGv7aprQ",6:"https://www.youtube.com/watch?v=jQraN1emvLQ",7:"https://www.youtube.com/watch?v=RONGNWb7OpQ",8:"https://www.youtube.com/watch?v=uh9jUhVTS28",9:"https://www.youtube.com/watch?v=pGrI6hk0vBg",10:"https://www.youtube.com/watch?v=m9cjOcCKIyQ",11:"https://www.youtube.com/watch?v=Cfm8TWGkvYQ",12:"https://www.youtube.com/watch?v=UtSEFdDZZLw"}},N={webhook:rt,videoLink:st},he=D({__name:"ReportDialog",props:{fileName:{type:String,required:!1,default:""},text:{type:String,required:!1,default:""}},setup(a){const e=a,t=v(""),n=v(""),r=v(!1),d=v(!1);async function m(){let p="";if(t.value&&(p+=`問題: ${t.value}
`),n.value&&(p+=`聯絡方式: ${n.value}
`),e.fileName&&(p+=`檔案名稱: ${e.fileName}
`),e.text&&(p+=`文字: ${e.text}
`),p){const u={content:p};await fetch(`https://discord.com/api/webhooks/${atob(N.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),r.value=!0}d.value=!1}return(p,u)=>(b(),R(Y,null,[o(j,{modelValue:d.value,"onUpdate:modelValue":u[2]||(u[2]=i=>d.value=i),activator:"parent","max-width":"600px",style:{maxHeight:"90vh"},transition:"dialog-bottom-transition"},{default:l(()=>[o(O,null,{default:l(()=>[o(Oe,null,{default:l(()=>u[4]||(u[4]=[S("回報問題")])),_:1}),o(ee,null,{default:l(()=>[o(X,{label:"你遭遇到的問題(選填)",modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=i=>t.value=i),outlined:""},null,8,["modelValue"]),o(X,{label:"你的聯絡方式(選填)",modelValue:n.value,"onUpdate:modelValue":u[1]||(u[1]=i=>n.value=i),outlined:""},null,8,["modelValue"])]),_:1}),o(W,null,{default:l(()=>[o(U,{onClick:m},{default:l(()=>u[5]||(u[5]=[S("送出")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(te,{modelValue:r.value,"onUpdate:modelValue":u[3]||(u[3]=i=>r.value=i),timeout:2e3,class:"text-center",rounded:"pill"},{default:l(()=>u[6]||(u[6]=[w("div",{class:"text-h6 mx-auto font-weight-bold text-center text-truncate"}," 已回報問題 ",-1)])),_:1},8,["modelValue"])],64))}}),it={key:0,class:"ml-2 d-flex align-center"},ut=D({__name:"FooterComponent",setup(a){const e=q(),t=v(!0),n=I({get(){return d.global.current.value.dark},set(s){m(s)}}),r=I({get(){return e.copyMode},set(s){e.copyMode=s,localStorage.setItem("copyURLMode",s.toString())}}),d=Pe();function m(s){d.global.name.value=s?"dark":"light",localStorage.setItem("darkTheme",d.global.name.value)}const p=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("firefox"),u=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("mobile"),i=()=>!(p()&&u());return Q(()=>{t.value=i(),t.value?localStorage.getItem("copyURLMode")?e.copyMode=localStorage.getItem("copyURLMode")==="true":e.copyMode=!1:e.copyMode=!0,localStorage.getItem("darkTheme")?d.global.name.value=localStorage.getItem("darkTheme")??"dark":window.matchMedia("(prefers-color-scheme: light)").matches&&(d.global.name.value="light")}),(s,c)=>{const y=he;return b(),V(je,{app:""},{default:l(()=>[o(pe,{fluid:"",style:{padding:"5px"}},{default:l(()=>[o(L,null,{default:l(()=>[o(A,null,{default:l(()=>[o(U,{variant:"text",size:"small",class:"text-center"},{default:l(()=>[c[7]||(c[7]=S(" 其他連結 ")),o(Le,{activator:"parent",location:"center"},{default:l(()=>[o(qe,null,{default:l(()=>[o(z,{icon:`mdiSvg:${g(G)}`},null,8,["icon"]),(b(),V(T,{key:0,target:"_blank",value:0,"append-icon":g(G),href:"https://github.com/NightFeather0615/Its-MyPic-Android"},{default:l(()=>[o(P,null,{default:l(()=>c[2]||(c[2]=[S("Its-MyPic for Android")])),_:1})]),_:1},8,["append-icon"])),(b(),V(T,{key:1,target:"_blank",value:1,"append-icon":g(G),href:"https://github.com/Its-MyPic/PowerToys-Run-Its-MyPic"},{default:l(()=>[o(P,null,{default:l(()=>c[3]||(c[3]=[S("PowerToys-Run Plugin")])),_:1})]),_:1},8,["append-icon"])),(b(),V(T,{key:2,target:"_blank",value:2,"append-icon":g(G),href:"https://github.com/Its-MyPic/krunner-Its-MyPic"},{default:l(()=>[o(P,null,{default:l(()=>c[4]||(c[4]=[S("Krunner Plugin")])),_:1})]),_:1},8,["append-icon"])),(b(),V(T,{key:3,target:"_blank",value:3,"append-icon":g(G),href:"https://github.com/Its-MyPic/Its-MyPic-vue"},{default:l(()=>[o(P,null,{default:l(()=>c[5]||(c[5]=[S("這個網頁的原始碼")])),_:1})]),_:1},8,["append-icon"])),(b(),V(T,{key:4,target:"_blank",value:4,"append-icon":g(G),href:"https://github.com/Its-MyPic/Its-MyPicDB"},{default:l(()=>[o(P,null,{default:l(()=>c[6]||(c[6]=[S("mygo系列的截圖資料")])),_:1})]),_:1},8,["append-icon"]))]),_:1})]),_:1})]),_:1}),o(U,{variant:"text",size:"small",class:"text-center"},{default:l(()=>[c[8]||(c[8]=S(" 回報問題 ")),o(y)]),_:1}),o(U,{variant:"text",size:"small",class:"text-center",href:"https://forms.gle/WzW9PZwUU6gqHZko7",target:"_blank"},{default:l(()=>c[9]||(c[9]=[S(" 投稿 ")])),_:1})]),_:1}),o(A,{cols:"1"},{default:l(()=>[o(U,{variant:"text",size:"small",density:"comfortable",icon:g(re)},{default:l(()=>[o(z,{icon:g(re),"aria-label":"設定"},null,8,["icon"]),o(j,{activator:"parent","max-width":"600px",style:{maxHeight:"90vh",minHeight:"200px"}},{default:l(()=>[o(O,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:l(()=>[c[14]||(c[14]=w("br",null,null,-1)),c[15]||(c[15]=w("span",{class:"ml-2 d-flex align-center"},"主題",-1)),o(A,{cols:"auto",class:"d-flex align-center"},{default:l(()=>[c[10]||(c[10]=w("span",{class:"mr-2 d-flex align-center"},"淺色",-1)),o(ne,{modelValue:n.value,"onUpdate:modelValue":c[0]||(c[0]=h=>n.value=h),class:"mx-2 d-flex align-center"},null,8,["modelValue"]),c[11]||(c[11]=w("span",{class:"ml-2 d-flex align-center"},"深色",-1))]),_:1}),c[16]||(c[16]=w("br",null,null,-1)),c[17]||(c[17]=w("span",{class:"ml-2 d-flex align-center"},"偏好複製模式",-1)),o(A,{cols:"auto",class:"d-flex align-center"},{default:l(()=>[c[12]||(c[12]=w("span",{class:"mr-2 d-flex align-center"},"複製圖片",-1)),o(ne,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=h=>r.value=h),class:"mx-2 d-flex align-center",disabled:!t.value},null,8,["modelValue","disabled"]),c[13]||(c[13]=w("span",{class:"ml-2 d-flex align-center"},"複製連結",-1))]),_:1}),t.value?K("",!0):(b(),R("span",it,"您的瀏覽器不支援複製圖片")),c[18]||(c[18]=w("br",null,null,-1))]),_:1})]),_:1})]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}});function be(a,e,t,n){return`${a}${e}/${t}/${n}.webp`}function ct(a,e,t,n){const r=e===M.AVE_MUJICA?B[M.AVE_MUJICA]:B[M.MYGO],d=String(t);return`${a[r][d]}&t=${n}s`}function xe(a,e){return`${a===M.AVE_MUJICA?B[M.AVE_MUJICA]:B[M.MYGO]} 第${e}話`}function dt(a){const e=a/we;return{minutes:Math.floor(e/60),seconds:Math.floor(e%60),totalSeconds:Math.round(e)}}function mt(a){return`${a.minutes}:${String(a.seconds).padStart(2,"0")}`}function Se(a){const e=dt(a);return mt(e)}function pt(a,e,t,n){const r=n?e[t]:0;return Math.round((a+r)/we)}const ft={class:"thumbnail-container"},gt={class:"image-container size"},vt=["src","alt"],wt={class:"timestamp-overlay"},yt=D({__name:"CardThumbnail",props:{cardData:{type:Object,required:!0},baseImageUrl:{type:String,required:!0}},emits:["click"],setup(a){const e=a,t=e.cardData.text,n=e.cardData.season,r=e.cardData.episode,d=e.cardData.frameStart,m=e.cardData.framePrefer,p=I(()=>xe(n,r)),u=I(()=>Se(d)),i=I(()=>be(e.baseImageUrl,n,r,m));return(s,c)=>(b(),R("div",ft,[o(O,{class:"card size",color:"surface-variant",rounded:"lg",variant:"tonal",onClick:c[0]||(c[0]=y=>s.$emit("click"))},{default:l(()=>[w("div",gt,[w("img",{src:i.value,class:"size",alt:g(t)},null,8,vt),w("div",wt,F(p.value)+" "+F(u.value),1)]),o(ee,{class:"card-text text-center justify-center"},{default:l(()=>[S(F(g(t)),1)]),_:1})]),_:1})]))}}),ae=(a,e)=>{const t=a.__vccOpts||a;for(const[n,r]of e)t[n]=r;return t},ht=ae(yt,[["__scopeId","data-v-ac887b68"]]);function bt(){let a=null;const e=()=>{if(a)return a;const r=document.createElement("canvas"),d=r.getContext("2d",{alpha:!1,willReadFrequently:!0});if(!d)throw new Error("Failed to get canvas context");return a={canvas:r,ctx:d},a};return{getContext:e,createPngBlob:async r=>{const{canvas:d,ctx:m}=e();return d.width=r.width,d.height=r.height,m.drawImage(r,0,0),d.toDataURL("image/png")},cleanup:()=>{a&&(a.canvas.width=0,a.canvas.height=0,a=null)}}}function xt(a){const e=(r,d)=>({name:r.name,message:r.message,stack:r.stack,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,additionalInfo:d}),t=async(r,d)=>{const m=e(typeof r=="string"?new Error(r):r,d),p=[`Error in ${a.context||"unknown context"}:`,`Name: ${m.name}`,`Message: ${m.message}`,m.userAgent?`UserAgent: ${m.userAgent}`:null,m.stack?`Stack: ${m.stack}`:null,m.additionalInfo?`Additional Info: ${JSON.stringify(m.additionalInfo,null,2)}`:null].filter(Boolean).join(`

`);try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:p})})}catch(u){console.error("Failed to send error report:",u)}};return{reportError:t,reportWithContext:r=>(d,m)=>t(d,{...m,context:r})}}function St(a){const e=bt(),t=xt({webhookUrl:a.webhookUrl,context:"ImageOperations"}),n=$e({isDownloading:!1,isCopying:!1,operationStatus:""}),r=async i=>{const s=new Image;return s.crossOrigin="Anonymous",s.src=i,new Promise((c,y)=>{s.onload=()=>c(s),s.onerror=y})},d=async(i,s)=>{if(!n.isDownloading){n.isDownloading=!0,n.operationStatus="下載中...";try{const c=await r(i),y=await e.createPngBlob(c),x=await(await fetch(y)).blob(),_=URL.createObjectURL(x),$=document.createElement("a");$.href=_,$.download=`${s}.png`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(_),n.operationStatus="下載完成"}catch(c){await t.reportError(c),n.operationStatus="下載失敗"}finally{n.isDownloading=!1}}},m=async i=>{if(!n.isCopying){n.isCopying=!0,n.operationStatus="";try{const s=await r(i),c=await e.createPngBlob(s),h=await(await fetch(c)).blob(),x=new ClipboardItem({"image/png":h});await navigator.clipboard.write([x]),n.operationStatus="圖片複製成功"}catch(s){throw await t.reportError(s),n.operationStatus="複製失敗，請稍後重試",s}finally{n.isCopying=!1}}},p=async i=>{if(!n.isCopying){n.isCopying=!0,n.operationStatus="";try{await navigator.clipboard.writeText(i),n.operationStatus="連結複製成功"}catch(s){throw await t.reportError(s),n.operationStatus="複製失敗",s}finally{n.isCopying=!1}}},u=()=>{e.cleanup()};return{isDownloading:Z(n,"isDownloading"),isCopying:Z(n,"isCopying"),operationStatus:Z(n,"operationStatus"),downloadImage:d,copyImage:m,copyUrl:p,cleanup:u}}const kt={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},Ct=D({__name:"ActionButtons",props:{cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},videoConfig:{type:Object,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["report","gif-create"],setup(a,{emit:e}){const t=a,n=e,r=q(),d=v(!1),m=St({webhookUrl:t.webhookUrl}),p=v(!1);ue(()=>m.operationStatus.value,h=>{h&&(p.value=!0)});const u=I(()=>{const h=pt(t.cardData.frameStart,Ke,t.cardData.episode,t.cardData.season===M.MYGO);return ct(t.videoConfig,t.cardData.season,t.cardData.episode,h)}),i=()=>{m.downloadImage(t.imageUrl,t.cardData.text)},s=async()=>{if(d.value){d.value=!1;return}try{r.copyMode?await m.copyUrl(t.imageUrl):await m.copyImage(t.imageUrl)}catch{}},c=async()=>{try{d.value=!0,await m.copyUrl(t.imageUrl)}catch{}},y=async()=>{n("gif-create")};return ce(()=>{d.value=!1}),(h,x)=>{const _=Fe("long-press");return b(),R(Y,null,[o(L,null,{default:l(()=>[o(U,{onClick:x[0]||(x[0]=$=>h.$emit("report"))},{default:l(()=>[x[2]||(x[2]=S(" 回報 ")),de(h.$slots,"report-dialog")]),_:3}),o(U,{onClick:i,loading:g(m).isDownloading.value},{default:l(()=>x[3]||(x[3]=[S("下載")])),_:1},8,["loading"]),o(U,{onClick:y,loading:a.isGifCreating},{default:l(()=>x[4]||(x[4]=[S("GIF")])),_:1},8,["loading"]),Re((b(),V(U,{onClick:s,loading:g(m).isCopying.value},{default:l(()=>x[5]||(x[5]=[S("複製")])),_:1},8,["loading"])),[[_,c]]),o(U,{href:u.value,target:"_blank"},{default:l(()=>x[6]||(x[6]=[S(" 從這裡開始看 ")])),_:1},8,["href"])]),_:3}),o(te,{modelValue:p.value,"onUpdate:modelValue":x[1]||(x[1]=$=>p.value=$),timeout:2e3,class:"text-center",rounded:"pill"},{default:l(()=>[w("div",kt,F(g(m).operationStatus),1)]),_:1},8,["modelValue"])],64)}}}),Vt={style:{position:"relative"}},Ut={class:"timestamp-overlay"},It=D({__name:"CardDialog",props:{show:{type:Boolean,required:!0},cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},videoConfig:{type:Object,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["update:show","report","gif-create"],setup(a){const e=a,t=e.cardData.text,n=e.cardData.season,r=e.cardData.episode,d=e.cardData.frameStart,m=I(()=>xe(n,r)),p=I(()=>Se(d));return(u,i)=>(b(),V(j,{"model-value":a.show,"onUpdate:modelValue":i[2]||(i[2]=s=>u.$emit("update:show",s)),"max-width":"600px",style:{maxHeight:"90vh"}},{default:l(()=>[o(O,null,{default:l(()=>[w("div",Vt,[o(fe,{src:a.imageUrl,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),w("div",Ut,F(m.value)+" "+F(p.value),1)]),o(L,null,{default:l(()=>[o(A,null,{default:l(()=>[o(ee,{class:"text-center"},{default:l(()=>[S(F(g(t)),1)]),_:1})]),_:1})]),_:1}),o(W,null,{default:l(()=>[o(Ct,{"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":a.imageUrl,"video-config":a.videoConfig,"is-gif-creating":a.isGifCreating,onReport:i[0]||(i[0]=s=>u.$emit("report")),onGifCreate:i[1]||(i[1]=s=>u.$emit("gif-create"))},{"report-dialog":l(()=>[de(u.$slots,"report-dialog",{},void 0,!0)]),_:3},8,["card-data","webhook-url","image-url","video-config","is-gif-creating"])]),_:3})]),_:3})]),_:3},8,["model-value"]))}}),Dt=ae(It,[["__scopeId","data-v-67eded5c"]]),Mt={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},$t="https://mypic.0m0.uk/images/",Ft=D({__name:"GifDialog",props:{text:{},season:{},episode:{},frameStart:{},frameEnd:{}},setup(a,{expose:e}){const t=new at;let n=!1;const r=a,d=v(!1),m=v(!1),p=v(""),u=v(!1),i=v(!1),s=v(!1),c=v(""),y=v(null),h=v(null);async function x(){n||(await t.load(),n=!0)}async function _(){if(!y.value)return;const k=document.createElement("a");k.href=URL.createObjectURL(y.value),k.download=`${r.text}.gif`,document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(k.href)}async function $(){const k=new File([y.value],"download.gif",{type:"image/gif"}),f=new FormData;f.append("fileToUpload",k),f.append("reqtype","fileupload");const C=await fetch("https://cors.0m0.uk/?https://catbox.moe/user/api.php",{method:"POST",body:f});if(C.status===413)throw new Error("GIF檔案過大，請自行下載後上傳至其他圖床");return await C.text()}async function ke(){if(!y.value)return;s.value=!0;const k=new ClipboardItem({"text/plain":(async()=>{try{if(h.value)return new Blob([h.value],{type:"text/plain"});p.value="正在上傳GIF...",m.value=!0;const f=await $();return h.value=f,new Blob([f],{type:"text/plain"})}catch(f){throw p.value=f instanceof Error?f.message:"GIF 上傳失敗",J(f),f}})()});try{await navigator.clipboard.write([k]),p.value="GIF 連結複製成功"}catch(f){f instanceof Error&&f.name==="NotAllowedError"?p.value="GIF 連結複製失敗":p.value=f instanceof Error?f.message:"GIF 上傳失敗",J(f)}finally{m.value=!0,s.value=!1}}async function Ce(){if(u.value)return;if(y.value){d.value=!0;return}h.value=null,u.value=!0,p.value="GIF生成中...",m.value=!0;const k=performance.now(),f=Array.from({length:r.frameEnd-r.frameStart-4},(C,E)=>r.frameStart+E+2);try{await x();const C=f.map(async oe=>{const Ue=`${$t}${r.season}/${r.episode}/${oe}.webp`,Ie=await tt(Ue);await t.writeFile(`${oe}.webp`,Ie)});await Promise.all(C),await t.exec(["-start_number",f[0].toString(),"-i","%d.webp","-vf","palettegen","palette.png"]),await t.exec(["-start_number",f[0].toString(),"-i","%d.webp","-i","palette.png","-filter_complex","paletteuse=dither=none","-frames:v",f.length.toString(),"-f","gif","-framerate","24","output.gif"]);const E=await t.readFile("output.gif");y.value=new Blob([E],{type:"image/gif"}),c.value=URL.createObjectURL(y.value);const Ve=((performance.now()-k)/1e3).toFixed(1);p.value=`GIF生成完成 (${Ve}秒)`,d.value=!0}catch(C){console.error("GIF generation failed:",C),J(C),p.value="GIF生成失敗"}finally{u.value=!1,m.value=!0;const C=f.map(E=>t.deleteFile(`${E}.webp`).catch(console.error));await Promise.all([...C,t.deleteFile("output.gif").catch(console.error),t.deleteFile("palette.png").catch(console.error)])}}async function J(k){const f={content:`Copy failed: ${k.name}

${navigator.userAgent}

${k.message}

${k.stack}`};try{await fetch(`https://discord.com/api/webhooks/${atob(N.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)})}catch(C){console.error("Failed to send error report to Discord:",C)}}return e({CreateGif:Ce,isGeneratingGif:u}),(k,f)=>(b(),R(Y,null,[o(j,{modelValue:d.value,"onUpdate:modelValue":f[0]||(f[0]=C=>d.value=C),"max-width":"600px",style:{maxHeight:"90vh"}},{default:l(()=>[o(O,null,{default:l(()=>[o(fe,{src:c.value,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),o(W,null,{default:l(()=>[o(L,null,{default:l(()=>[o(U,{onClick:_,loading:i.value},{default:l(()=>f[2]||(f[2]=[S("下載")])),_:1},8,["loading"]),o(U,{onClick:ke,loading:s.value},{default:l(()=>f[3]||(f[3]=[S("生成連結")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(te,{modelValue:m.value,"onUpdate:modelValue":f[1]||(f[1]=C=>m.value=C),timeout:2e3,class:"text-center",rounded:"pill"},{default:l(()=>[w("div",Mt,F(p.value),1)]),_:1},8,["modelValue"])],64))}}),Rt=D({__name:"index",props:{styles:{type:Object,required:!0},cardData:{type:Object,required:!0},videoConfig:{type:Object,required:!0},webhookUrl:{type:String,required:!0},baseImageUrl:{type:String,default:"https://mypic.0m0.uk/images/"}},setup(a){const e=a,t=v(!1),n=v(null),r=I(()=>be(e.baseImageUrl,e.cardData.season,e.cardData.episode,e.cardData.framePrefer)),d=()=>{},m=async()=>{n.value&&await n.value.CreateGif()};return(p,u)=>{var i;return b(),R("div",{style:me(a.styles)},[o(ht,{"card-data":a.cardData,"base-image-url":a.baseImageUrl,onClick:u[0]||(u[0]=s=>t.value=!0)},null,8,["card-data","base-image-url"]),o(Dt,{show:t.value,"onUpdate:show":u[1]||(u[1]=s=>t.value=s),"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":r.value,"video-config":a.videoConfig,onReport:d,onGifCreate:m,"is-gif-creating":(i=n.value)==null?void 0:i.isGeneratingGif},{"report-dialog":l(()=>[o(he,{"file-name":r.value,text:a.cardData.text},null,8,["file-name","text"])]),_:1},8,["show","card-data","webhook-url","image-url","video-config","is-gif-creating"]),o(Ft,{ref_key:"gifDialogRef",ref:n,text:a.cardData.text,season:a.cardData.season,episode:a.cardData.episode,"frame-start":a.cardData.frameStart,"frame-end":a.cardData.frameEnd},null,8,["text","season","episode","frame-start","frame-end"])],4)}}}),_t=D({__name:"ResultGrid",setup(a){const e=lt(),t=q(),{filteredCards:n}=et(e),r=I(()=>`https://discord.com/api/webhooks/${atob(N.webhook)}`);let d=v(24);const m=()=>{d.value=(1+Math.floor((window.innerWidth-320)/310))*8},p=I(()=>{typeof window<"u"&&window.scrollTo({top:0,left:0,behavior:"smooth"});const i=n.value;return t.isReversed,(s,c)=>{const y=i.slice(s*c,(s+1)*c);return Promise.resolve(y)}}),u=i=>{var s=i.value;return s==null?void 0:s.segmentId};return Q(()=>{m(),window.addEventListener("resize",m)}),ce(()=>{window.removeEventListener("resize",m)}),(i,s)=>(b(),V(_e,null,{default:l(()=>[o(g(ot),{length:g(n).length?g(n).length:1,pageSize:g(d),pageProvider:p.value,"get-key":u,"page-provider-debounce-time":100,class:"grid ma-5"},{placeholder:l(({index:c,style:y})=>[w("div",{class:"item",style:me(y)},F(g(n).length?"還在GO...":""),5)]),default:l(({item:c,style:y,index:h})=>[o(Rt,{styles:y,"card-data":c,"video-config":g(N).videoLink,"webhook-url":r.value},null,8,["styles","card-data","video-config","webhook-url"])]),_:1},8,["length","pageSize","pageProvider"])]),fallback:l(()=>s[0]||(s[0]=[w("p",null,"Loading...",-1)])),_:1}))}}),Et=ae(_t,[["__scopeId","data-v-fde939d1"]]),ie=D({__name:"MultiSelect",props:Ee({items:{type:Array,required:!0},label:{type:String,required:!1,default:"Select"}},{modelValue:{type:Array,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const e=a,t=Ge(a,"modelValue"),n=I(()=>t.value.length===e.items.length),r=I(()=>t.value.length>0&&t.value.length<e.items.length),d=()=>{n.value?t.value=[]:t.value=[...e.items]};return ue(t,()=>{t.value.sort()}),(m,p)=>(b(),V(Ne,{modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=u=>t.value=u),label:a.label,variant:"outlined",multiple:"",items:a.items,style:{"min-width":"250px"}},{"prepend-item":l(()=>[o(T,{title:"全選",onClick:d},{prepend:l(()=>[o(ze,{indeterminate:r.value,"model-value":n.value},null,8,["indeterminate","model-value"])]),_:1}),o(Be,{class:"mt-2"})]),selection:l(({item:u,index:i})=>[t.value.length!=a.items.length?(b(),V(le,{key:0},{default:l(()=>[w("span",null,F(u.value),1)]),_:2},1024)):K("",!0),i===a.items.length-1?(b(),V(le,{key:1},{default:l(()=>p[1]||(p[1]=[w("span",null,"全選",-1)])),_:1})):K("",!0)]),_:1},8,["modelValue","label","items"]))}}),Gt=D({__name:"FilterDialog",setup(a){const e=ge(),t=v(!1),n=v([]),r=v([]),d=v([]),m=()=>{r.value=[],d.value=[],n.value=[]},p=()=>{e.mygoEpisodes=r.value,e.avemujicaEpisodes=d.value,e.characterId=0,t.value=!1};return Q(()=>{r.value=e.mygoEpisodes,d.value=e.avemujicaEpisodes}),(u,i)=>(b(),V(j,{modelValue:t.value,"onUpdate:modelValue":i[2]||(i[2]=s=>t.value=s),"max-width":"600px",style:{"min-height":"600px"},transition:"dialog-top-transition"},{activator:l(({props:s})=>[o(z,Te(s,{icon:g(Qe)}),null,16,["icon"])]),default:l(()=>[o(O,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:l(()=>[i[3]||(i[3]=w("br",null,null,-1)),i[4]||(i[4]=w("br",null,null,-1)),i[5]||(i[5]=w("span",{class:"align-center"},"集數篩選",-1)),o(ie,{items:g(se)[g(M).MYGO],modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=s=>r.value=s),label:"MyGO",style:{"min-width":"250px"}},null,8,["items","modelValue"]),o(ie,{items:g(se)[g(M).AVE_MUJICA],modelValue:d.value,"onUpdate:modelValue":i[1]||(i[1]=s=>d.value=s),label:"Ave Mujica",style:{"min-width":"250px"}},null,8,["items","modelValue"]),o(W,null,{default:l(()=>[o(U,{class:"text-center",text:"清除篩選",onClick:m}),o(U,{class:"text-center",text:"確定",onClick:p})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Tt=D({__name:"AppBarComponent",setup(a){const e=q(),t=ve(),n=v(""),r=Xe(()=>{t.query=n.value},500),d=()=>{t.query=n.value},m=()=>{n.value="",t.query=""};return Q(()=>{const u=new URLSearchParams(window.location.search).get("q");u&&(n.value=u,t.query=u)}),(p,u)=>{const i=Gt;return b(),V(Ye,{density:"prominent"},{default:l(()=>[o(pe,null,{default:l(()=>[u[1]||(u[1]=w("div",{class:"text-h5 mx-auto font-weight-bold text-center text-truncate"}," MyGO Mujica 截圖搜尋器 ",-1)),o(L,{dense:"",class:"mt-2"},{default:l(()=>[o(A,{class:"text-center"},{default:l(()=>[o(X,{modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=s=>n.value=s),"single-line":"","hide-details":"",clearable:"",label:"搜尋",variant:"outlined",class:"short-search",onKeyup:Ae(d,["enter"]),"onClick:clear":m,onInput:g(r),autofocus:""},{append:l(()=>[o(z,{onClick:g(e).toggleReverse,icon:g(e).isReversed?g(We):g(Je)},null,8,["onClick","icon"])]),"append-inner":l(()=>[o(i)]),_:1},8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),ea=D({__name:"index",setup(a){return(e,t)=>{const n=Tt,r=Et,d=ut;return b(),R(Y,null,[o(n),o(r),o(d,{style:{width:"100%"}})],64)}}});export{ea as default};
