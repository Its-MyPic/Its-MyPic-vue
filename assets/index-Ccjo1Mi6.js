var De=Object.defineProperty;var $e=(a,t,e)=>t in a?De(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var K=(a,t,e)=>$e(a,typeof t!="symbol"?t+"":t,e);import{r as y,c as _,k as M,D as C,I as T,X as n,F as r,a5 as I,a7 as x,J as W,l as H,E as D,u as w,a8 as ee,$ as A,f as _e,b as X,w as de,O as me,a2 as Me,H as pe,B as Fe,L as fe,a9 as Re,aa as Ae,ab as Ee,Y as Oe,ac as Te}from"./@vue-D9bH4lrz.js";import{e as L,f as Ge,g as ae,h as te,i as Z,j as $,k as N,l as oe,u as Pe,n as je,o as B,p as j,q as Le,r as ze,s as Y,t as P,v as z,w as le,x as ge,y as ve,z as Ne,A as Be,B as se,C as qe,D as Ye}from"./vuetify-LsV7B-xS.js";import{m as G,a as ie,b as Je,c as Qe,d as We}from"./@mdi-DKC2W5MC.js";import{u as He,a as we,b as ye,S as R,n as Ze,c as J,F as he,M as Ke,E as ue,d as Xe}from"./app-BHJYDskf.js";import{d as be,s as et}from"./pinia-B-uPeou1.js";import{f as tt,F as at}from"./@ffmpeg-B1ncfXmI.js";import{G as ot}from"./vue-virtual-scroll-grid-DSIWnnUt.js";import"./vite-ssg-CQCaBNHx.js";import"./vue-router-Y811DZoV.js";import"./@unhead-DsvcCsHo.js";import"./unhead-CpyiRjm1.js";import"./hookable-B7_1qfUG.js";import"./protobufjs-CgPuVhCO.js";import"./@protobufjs-f4nnaicZ.js";import"./opencc-js-D2OnpAg6.js";const q=be("ui",()=>{const a=y(!1),t=y(!1);return{isReversed:a,copyMode:t,toggleReverse:()=>{a.value=!a.value},toggleCopyMode:()=>{t.value=!t.value}}});class nt{constructor(t){K(this,"cache");K(this,"capacity");if(t<=0)throw new Error("Cache capacity must be greater than 0");this.cache=new Map,this.capacity=t}has(t){return this.cache.has(t)}get(t){const e=this.cache.get(t);if(e)return this.cache.delete(t),this.cache.set(t,e),e}set(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.capacity){const o=this.cache.keys().next();o.done||this.cache.delete(o.value)}this.cache.set(t,e)}clear(){this.cache.clear()}get size(){return this.cache.size}get maxSize(){return this.capacity}keys(){return this.cache.keys()}values(){return this.cache.values()}entries(){return this.cache.entries()}}const rt=be("results",()=>{const a=He(),t=we(),e=ye(),o=q(),u=new nt(50);return{filteredCards:_(()=>{const f=a.cards;if(!f.length)return[];const p=t.activeFilters,i=JSON.stringify({mygo:Array.from(p.mygo),avemujica:Array.from(p.avemujica)});let c;return u.has(i)?c=u.get(i):(c=f.filter(s=>p.mygo.size&&s.season===R.MYGO?p.mygo.has(s.episode):p.avemujica.size&&s.season===R.AVE_MUJICA?p.avemujica.has(s.episode):p.mygo.size===0&&p.avemujica.size===0),u.set(i,c)),e.normalizedQuery&&(c=c.filter(s=>Ze(s.text).includes(e.normalizedQuery))),o.isReversed?[...c].reverse():c})}}),lt="MTMzNTEwMzQ1NzY4MTczNTc2MC9LT0lwZ2FDc3RmRURnVHVqR2dEYmVYWWZSLUdZRjVQQ29veXZ0TFVGbFhFM0tYdGRGTzhHR3RrTXptWEp4R3FxQVI5bw==",st={MyGO:{1:"https://www.youtube.com/watch?v=WOrYBIYIwyk",2:"https://www.youtube.com/watch?v=WOrYBIYIwyk",3:"https://www.youtube.com/watch?v=WOrYBIYIwyk",4:"https://www.youtube.com/watch?v=ijdspfPMzYc",5:"https://www.youtube.com/watch?v=zfA0zRAkAdk",6:"https://www.youtube.com/watch?v=UwgyEoB9vU8",7:"https://www.youtube.com/watch?v=rlY2b3TIYPs",8:"https://www.youtube.com/watch?v=mfboDpl88QY",9:"https://www.youtube.com/watch?v=ySjYENzyZmY",10:"https://www.youtube.com/watch?v=bLWDIYpGcEI",11:"https://www.youtube.com/watch?v=gAFDVnhX24o",12:"https://www.youtube.com/watch?v=wei3payuSi8",13:"https://www.youtube.com/watch?v=uQ3_PvPCNnI"},"Ave Mujica":{1:"https://www.youtube.com/watch?v=dxmmSFQxWzM",2:"https://www.youtube.com/watch?v=Bzl61esi4qc",3:"https://www.youtube.com/watch?v=HagaJboujK4",4:"https://www.youtube.com/watch?v=Z6cOxtDsfNU",5:"https://www.youtube.com/watch?v=7D2uGv7aprQ",6:"https://www.youtube.com/watch?v=jQraN1emvLQ",7:"https://www.youtube.com/watch?v=RONGNWb7OpQ",8:"https://www.youtube.com/watch?v=uh9jUhVTS28",9:"https://www.youtube.com/watch?v=pGrI6hk0vBg",10:"https://www.youtube.com/watch?v=m9cjOcCKIyQ",11:"https://www.youtube.com/watch?v=Cfm8TWGkvYQ",12:"https://www.youtube.com/watch?v=UtSEFdDZZLw"}},Q={webhook:lt,videoLink:st},xe=M({__name:"ReportDialog",props:{fileName:{type:String,required:!1,default:""},text:{type:String,required:!1,default:""}},setup(a){const t=a,e=y(""),o=y(""),u=y(!1),m=y(!1);async function f(){let p="";if(e.value&&(p+=`問題: ${e.value}
`),o.value&&(p+=`聯絡方式: ${o.value}
`),t.fileName&&(p+=`檔案名稱: ${t.fileName}
`),t.text&&(p+=`文字: ${t.text}
`),p){const i={content:p};await fetch(`https://discord.com/api/webhooks/${atob(Q.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),u.value=!0}m.value=!1}return(p,i)=>(C(),T(W,null,[n(N,{modelValue:m.value,"onUpdate:modelValue":i[2]||(i[2]=c=>m.value=c),activator:"parent","max-width":"600px",style:{maxHeight:"90vh"},transition:"dialog-bottom-transition"},{default:r(()=>[n(L,null,{default:r(()=>[n(Ge,null,{default:r(()=>i[4]||(i[4]=[I("回報問題")])),_:1}),n(ae,null,{default:r(()=>[n(te,{label:"你遭遇到的問題(選填)",modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=c=>e.value=c),outlined:""},null,8,["modelValue"]),n(te,{label:"你的聯絡方式(選填)",modelValue:o.value,"onUpdate:modelValue":i[1]||(i[1]=c=>o.value=c),outlined:""},null,8,["modelValue"])]),_:1}),n(Z,null,{default:r(()=>[n($,{onClick:f},{default:r(()=>i[5]||(i[5]=[I("送出")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(oe,{modelValue:u.value,"onUpdate:modelValue":i[3]||(i[3]=c=>u.value=c),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>i[6]||(i[6]=[x("div",{class:"text-h6 mx-auto font-weight-bold text-center text-truncate"}," 已回報問題 ",-1)])),_:1},8,["modelValue"])],64))}}),it={key:0,class:"ml-2 d-flex align-center"},ut=M({__name:"FooterComponent",setup(a){const t=q(),e=y(!0),o=_({get(){return m.global.current.value.dark},set(s){f(s)}}),u=_({get(){return t.copyMode},set(s){t.copyMode=s,localStorage.setItem("copyURLMode",s.toString())}}),m=Pe();function f(s){m.global.name.value=s?"dark":"light",localStorage.setItem("darkTheme",m.global.name.value)}const p=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("firefox"),i=()=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes("mobile"),c=()=>!(p()&&i());return H(()=>{e.value=c(),e.value?localStorage.getItem("copyURLMode")?t.copyMode=localStorage.getItem("copyURLMode")==="true":t.copyMode=!1:t.copyMode=!0,localStorage.getItem("darkTheme")?m.global.name.value=localStorage.getItem("darkTheme")??"dark":window.matchMedia("(prefers-color-scheme: light)").matches&&(m.global.name.value="light")}),(s,l)=>{const v=xe;return C(),D(je,{app:""},{default:r(()=>[n(ge,{fluid:"",style:{padding:"5px"}},{default:r(()=>[n(B,null,{default:r(()=>[n(j,null,{default:r(()=>[n($,{variant:"text",size:"small",class:"text-center"},{default:r(()=>[l[7]||(l[7]=I(" 其他連結 ")),n(Le,{activator:"parent",location:"center"},{default:r(()=>[n(ze,null,{default:r(()=>[n(Y,{icon:`mdiSvg:${w(G)}`},null,8,["icon"]),(C(),D(P,{key:0,target:"_blank",value:0,"append-icon":w(G),href:"https://github.com/NightFeather0615/Its-MyPic-Android"},{default:r(()=>[n(z,null,{default:r(()=>l[2]||(l[2]=[I("Its-MyPic for Android")])),_:1})]),_:1},8,["append-icon"])),(C(),D(P,{key:1,target:"_blank",value:1,"append-icon":w(G),href:"https://github.com/Its-MyPic/PowerToys-Run-Its-MyPic"},{default:r(()=>[n(z,null,{default:r(()=>l[3]||(l[3]=[I("PowerToys-Run Plugin")])),_:1})]),_:1},8,["append-icon"])),(C(),D(P,{key:2,target:"_blank",value:2,"append-icon":w(G),href:"https://github.com/Its-MyPic/krunner-Its-MyPic"},{default:r(()=>[n(z,null,{default:r(()=>l[4]||(l[4]=[I("Krunner Plugin")])),_:1})]),_:1},8,["append-icon"])),(C(),D(P,{key:3,target:"_blank",value:3,"append-icon":w(G),href:"https://github.com/Its-MyPic/Its-MyPic-vue"},{default:r(()=>[n(z,null,{default:r(()=>l[5]||(l[5]=[I("這個網頁的原始碼")])),_:1})]),_:1},8,["append-icon"])),(C(),D(P,{key:4,target:"_blank",value:4,"append-icon":w(G),href:"https://github.com/Its-MyPic/Its-MyPicDB"},{default:r(()=>[n(z,null,{default:r(()=>l[6]||(l[6]=[I("mygo系列的截圖資料")])),_:1})]),_:1},8,["append-icon"]))]),_:1})]),_:1})]),_:1}),n($,{variant:"text",size:"small",class:"text-center"},{default:r(()=>[l[8]||(l[8]=I(" 回報問題 ")),n(v)]),_:1}),n($,{variant:"text",size:"small",class:"text-center",href:"https://forms.gle/WzW9PZwUU6gqHZko7",target:"_blank"},{default:r(()=>l[9]||(l[9]=[I(" 投稿 ")])),_:1})]),_:1}),n(j,{cols:"1"},{default:r(()=>[n($,{variant:"text",size:"small",density:"comfortable",icon:w(ie)},{default:r(()=>[n(Y,{icon:w(ie),"aria-label":"設定"},null,8,["icon"]),n(N,{activator:"parent","max-width":"600px",style:{maxHeight:"90vh",minHeight:"200px"}},{default:r(()=>[n(L,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:r(()=>[l[14]||(l[14]=x("br",null,null,-1)),l[15]||(l[15]=x("span",{class:"ml-2 d-flex align-center"},"主題",-1)),n(j,{cols:"auto",class:"d-flex align-center"},{default:r(()=>[l[10]||(l[10]=x("span",{class:"mr-2 d-flex align-center"},"淺色",-1)),n(le,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=h=>o.value=h),class:"mx-2 d-flex align-center"},null,8,["modelValue"]),l[11]||(l[11]=x("span",{class:"ml-2 d-flex align-center"},"深色",-1))]),_:1}),l[16]||(l[16]=x("br",null,null,-1)),l[17]||(l[17]=x("span",{class:"ml-2 d-flex align-center"},"偏好複製模式",-1)),n(j,{cols:"auto",class:"d-flex align-center"},{default:r(()=>[l[12]||(l[12]=x("span",{class:"mr-2 d-flex align-center"},"複製圖片",-1)),n(le,{modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=h=>u.value=h),class:"mx-2 d-flex align-center",disabled:!e.value},null,8,["modelValue","disabled"]),l[13]||(l[13]=x("span",{class:"ml-2 d-flex align-center"},"複製連結",-1))]),_:1}),e.value?ee("",!0):(C(),T("span",it,"您的瀏覽器不支援複製圖片")),l[18]||(l[18]=x("br",null,null,-1))]),_:1})]),_:1})]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})}}});function Se(a,t,e,o){return`${a}${t}/${e}/${o}.webp`}function ct(a,t,e,o){const u=t===R.AVE_MUJICA?J[R.AVE_MUJICA]:J[R.MYGO],m=String(e);return`${a[u][m]}&t=${o}s`}function ke(a,t){return`${a===R.AVE_MUJICA?J[R.AVE_MUJICA]:J[R.MYGO]} 第${t}話`}function dt(a){const t=a/he;return{minutes:Math.floor(t/60),seconds:Math.floor(t%60),totalSeconds:Math.round(t)}}function mt(a){return`${a.minutes}:${String(a.seconds).padStart(2,"0")}`}function Ce(a){const t=dt(a);return mt(t)}function pt(a,t,e,o){const u=o?t[e]:0;return Math.round((a+u)/he)}const ft={class:"thumbnail-container"},gt={class:"image-container size"},vt=["src","alt"],wt={class:"timestamp-overlay"},yt=M({__name:"CardThumbnail",props:{cardData:{type:Object,required:!0},baseImageUrl:{type:String,required:!0}},emits:["click"],setup(a){const t=a,e=t.cardData.text,o=t.cardData.season,u=t.cardData.episode,m=t.cardData.frame.start,f=t.cardData.frame.prefer,p=_(()=>ke(o,u)),i=_(()=>Ce(m)),c=_(()=>Se(t.baseImageUrl,o,u,f));return(s,l)=>(C(),T("div",ft,[n(L,{class:"card size",color:"surface-variant",rounded:"lg",variant:"tonal",onClick:l[0]||(l[0]=v=>s.$emit("click"))},{default:r(()=>[x("div",gt,[x("img",{src:c.value,class:"size",alt:w(e)},null,8,vt),x("div",wt,A(p.value)+" "+A(i.value),1)]),n(ae,{class:"card-text text-center justify-center"},{default:r(()=>[I(A(w(e)),1)]),_:1})]),_:1})]))}}),ne=(a,t)=>{const e=a.__vccOpts||a;for(const[o,u]of t)e[o]=u;return e},ht=ne(yt,[["__scopeId","data-v-ecf2b807"]]);function bt(){let a=null;const t=()=>{if(a)return a;const u=document.createElement("canvas"),m=u.getContext("2d",{alpha:!1,willReadFrequently:!0});if(!m)throw new Error("Failed to get canvas context");return a={canvas:u,ctx:m},a};return{getContext:t,createPngBlob:u=>{const{canvas:m,ctx:f}=t();return m.width=u.width,m.height=u.height,f.drawImage(u,0,0),m.toDataURL("image/png")},cleanup:()=>{a&&(a.canvas.width=0,a.canvas.height=0,a=null)}}}function xt(a){const t=y([]),e=y([]),o=y({}),u=()=>{var d;return{timestamp:Date.now(),timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,platform:typeof navigator<"u"?navigator.platform:"unknown",screenResolution:typeof window<"u"?`${window.screen.width}x${window.screen.height}`:void 0,language:typeof navigator<"u"?navigator.language:"unknown",memoryUsage:(d=performance==null?void 0:performance.memory)==null?void 0:d.usedJSHeapSize}},m=d=>({path:(d==null?void 0:d.path)||window.location.pathname,lastAction:t.value[t.value.length-1],componentStack:[...e.value],lastStateChange:{...o.value}}),f=d=>{t.value=[...t.value.slice(-9),d]},p=(d,U)=>{if(U)e.value.push(d);else{const k=e.value.lastIndexOf(d);k!==-1&&e.value.splice(k,1)}},i=(d,U)=>{if(o.value[d]=U,Object.keys(o.value).length>10){const k=Object.keys(o.value);delete o.value[k[0]]}},c=d=>d instanceof TypeError||d instanceof ReferenceError?"critical":d.message.includes("network")||d.message.includes("fetch")?"high":d.message.includes("undefined")||d.message.includes("null")?"medium":"low",s=(d,U,k)=>({name:d.name,message:d.message,stack:d.stack,userAgent:typeof navigator<"u"?navigator.userAgent:void 0,severity:c(d),systemInfo:u(),userContext:m(U),additionalInfo:k}),l=async(d,U,k)=>{var g;const S=s(typeof d=="string"?new Error(d):d,U,k),O=[`[${S.severity.toUpperCase()}] Error in ${a.context||"unknown context"}:`,`Time: ${new Date(S.systemInfo.timestamp).toISOString()}`,`Name: ${S.name}`,`Message: ${S.message}`,`Path: ${S.userContext.path}`,`Last Action: ${S.userContext.lastAction||"none"}`,`Component Stack: ${(g=S.userContext.componentStack)==null?void 0:g.join(" -> ")}`,S.userAgent?`UserAgent: ${S.userAgent}`:null,`System Info: ${JSON.stringify(S.systemInfo,null,2)}`,S.stack?`Stack: ${S.stack}`:null,S.additionalInfo?`Additional Info: ${JSON.stringify(S.additionalInfo,null,2)}`:null,S.userContext.lastStateChange?`Last State Changes: ${JSON.stringify(S.userContext.lastStateChange,null,2)}`:null].filter(Boolean).join(`

`),E=a.maxRetries||3;let b=0;for(;b<E;)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:O})});break}catch(V){if(b++,b===E){console.error("Failed to send error report after multiple retries:",V);const F=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");F.push({content:O,timestamp:Date.now()}),localStorage.setItem("failedErrorReports",JSON.stringify(F))}await new Promise(F=>setTimeout(F,1e3*b))}},v=d=>(U,k,S)=>l(U,k,{...S,context:d});return typeof window<"u"&&setInterval(async()=>{const d=JSON.parse(localStorage.getItem("failedErrorReports")||"[]");if(d.length===0)return;const U=[];for(const k of d)try{await fetch(a.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:k.content})})}catch{Date.now()-k.timestamp<24*60*60*1e3&&U.push(k)}localStorage.setItem("failedErrorReports",JSON.stringify(U))},30*60*1e3),{reportError:l,reportWithContext:v,trackAction:f,trackComponent:p,trackStateChange:i}}function St(a){const t=bt(),e=xt({webhookUrl:a.webhookUrl,context:"ImageOperations"}),o=_e({isDownloading:!1,isCopying:!1,operationStatus:""}),u=s=>{const l=new Image;return l.crossOrigin="Anonymous",l.src=s,l},m=s=>new Promise((l,v)=>{const h=u(s);h.onload=()=>l(h),h.onerror=v}),f=(s,l)=>{if(o.isDownloading)return;e.trackAction(`download_image_start:${l}`),o.isDownloading=!0,o.operationStatus="下載中...";const v=u(s);v.onload=()=>{const h=t.createPngBlob(v),d=document.createElement("a");d.href=h,d.download=`${l}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),o.operationStatus="下載完成",e.trackAction(`download_image_success:${l}`),o.isDownloading=!1},v.onerror=()=>{e.trackAction(`download_image_error:${l}`),e.reportError(new Error("Failed to load image"),void 0,{imageUrl:s,filename:l,operation:"download"}),o.operationStatus="下載失敗",o.isDownloading=!1}},p=async s=>{if(o.isCopying)return;e.trackAction("copy_image_start"),o.isCopying=!0,o.operationStatus="";const l=new Promise((v,h)=>{m(s).then(d=>{const k=t.createPngBlob(d).split(","),S=atob(k[1]),O=S.length,E=new Uint8Array(O);for(let b=0;b<O;b++)E[b]=S.charCodeAt(b);v(new Blob([E],{type:"image/png"}))}).catch(h)});try{const v=new ClipboardItem({"image/png":l});await navigator.clipboard.write([v]),o.operationStatus="圖片複製成功",e.trackAction("copy_image_success")}catch(v){throw e.trackAction("copy_image_error"),e.reportError(v,void 0,{imageUrl:s,operation:"copyImage",clipboardSupported:!!navigator.clipboard}),o.operationStatus="複製失敗，請稍後重試",v}finally{o.isCopying=!1}},i=async s=>{if(!o.isCopying){e.trackAction("copy_url_start"),o.isCopying=!0,o.operationStatus="";try{await navigator.clipboard.writeText(s),o.operationStatus="連結複製成功",e.trackAction("copy_url_success")}catch(l){throw e.trackAction("copy_url_error"),e.reportError(l,void 0,{url:s,operation:"copyUrl",clipboardSupported:!!navigator.clipboard}),o.operationStatus="複製失敗",l}finally{o.isCopying=!1}}},c=()=>{t.cleanup(),e.trackAction("image_operations_cleanup")};return e.trackComponent("ImageOperations",!0),{isDownloading:X(o,"isDownloading"),isCopying:X(o,"isCopying"),operationStatus:X(o,"operationStatus"),downloadImage:f,copyImage:p,copyUrl:i,cleanup:c}}const kt={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},Ct=M({__name:"ActionButtons",props:{cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},videoConfig:{type:Object,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["report","gif-create"],setup(a,{emit:t}){const e=a,o=t,u=q(),m=y(!1),f=St({webhookUrl:e.webhookUrl}),p=y(!1);de(()=>f.operationStatus.value,h=>{h&&(p.value=!0)});const i=_(()=>{const h=pt(e.cardData.frame.start,Ke,e.cardData.episode,e.cardData.season===R.MYGO);return ct(e.videoConfig,e.cardData.season,e.cardData.episode,h)}),c=()=>{f.downloadImage(e.imageUrl,e.cardData.text)},s=async()=>{if(m.value){m.value=!1;return}try{u.copyMode?await f.copyUrl(e.imageUrl):await f.copyImage(e.imageUrl)}catch{}},l=async()=>{try{m.value=!0,await f.copyUrl(e.imageUrl)}catch{}},v=()=>{o("gif-create")};return me(()=>{m.value=!1}),(h,d)=>{const U=Me("long-press");return C(),T(W,null,[n(B,null,{default:r(()=>[n($,{onClick:d[0]||(d[0]=k=>h.$emit("report"))},{default:r(()=>[d[2]||(d[2]=I(" 回報 ")),pe(h.$slots,"report-dialog")]),_:3}),n($,{onClick:c,loading:w(f).isDownloading.value},{default:r(()=>d[3]||(d[3]=[I("下載")])),_:1},8,["loading"]),n($,{onClick:v,loading:a.isGifCreating},{default:r(()=>d[4]||(d[4]=[I("GIF")])),_:1},8,["loading"]),Fe((C(),D($,{onClick:s,loading:w(f).isCopying.value},{default:r(()=>d[5]||(d[5]=[I("複製")])),_:1},8,["loading"])),[[U,l]]),n($,{href:i.value,target:"_blank"},{default:r(()=>d[6]||(d[6]=[I(" 從這裡開始看 ")])),_:1},8,["href"])]),_:3}),n(oe,{modelValue:p.value,"onUpdate:modelValue":d[1]||(d[1]=k=>p.value=k),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>[x("div",kt,A(w(f).operationStatus),1)]),_:1},8,["modelValue"])],64)}}}),It={style:{position:"relative"}},Ut={class:"timestamp-overlay"},Vt=M({__name:"CardDialog",props:{show:{type:Boolean,required:!0},cardData:{type:Object,required:!0},webhookUrl:{type:String,required:!0},imageUrl:{type:String,required:!0},videoConfig:{type:Object,required:!0},isGifCreating:{type:Boolean,default:!1}},emits:["update:show","report","gif-create"],setup(a){const t=a,e=t.cardData.text,o=t.cardData.season,u=t.cardData.episode,m=t.cardData.frame.start,f=_(()=>ke(o,u)),p=_(()=>Ce(m));return(i,c)=>(C(),D(N,{"model-value":a.show,"onUpdate:modelValue":c[2]||(c[2]=s=>i.$emit("update:show",s)),"max-width":"600px",style:{maxHeight:"90vh"}},{default:r(()=>[n(L,null,{default:r(()=>[x("div",It,[n(ve,{src:a.imageUrl,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),x("div",Ut,A(f.value)+" "+A(p.value),1)]),n(B,null,{default:r(()=>[n(j,null,{default:r(()=>[n(ae,{class:"text-center"},{default:r(()=>[I(A(w(e)),1)]),_:1})]),_:1})]),_:1}),n(Z,null,{default:r(()=>[n(Ct,{"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":a.imageUrl,"video-config":a.videoConfig,"is-gif-creating":a.isGifCreating,onReport:c[0]||(c[0]=s=>i.$emit("report")),onGifCreate:c[1]||(c[1]=s=>i.$emit("gif-create"))},{"report-dialog":r(()=>[pe(i.$slots,"report-dialog",{},void 0,!0)]),_:3},8,["card-data","webhook-url","image-url","video-config","is-gif-creating"])]),_:3})]),_:3})]),_:3},8,["model-value"]))}}),Dt=ne(Vt,[["__scopeId","data-v-aaed478d"]]),$t={class:"text-h6 mx-auto font-weight-bold text-center text-truncate"},_t="https://mypic.0m0.uk/images/",Mt=M({__name:"GifDialog",props:{text:{},season:{},episode:{},frameStart:{},frameEnd:{}},setup(a,{expose:t}){const e=new at;let o=!1;const u=a,m=y(!1),f=y(!1),p=y(""),i=y(!1),c=y(!1),s=y(!1),l=y(""),v=y(null),h=y(null);async function d(){o||(await e.load(),o=!0)}async function U(){if(!v.value)return;const b=document.createElement("a");b.href=URL.createObjectURL(v.value),b.download=`${u.text}.gif`,document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(b.href)}async function k(){const b=new File([v.value],"download.gif",{type:"image/gif"}),g=new FormData;g.append("fileToUpload",b),g.append("reqtype","fileupload");const V=await fetch("https://cors.0m0.uk/?https://catbox.moe/user/api.php",{method:"POST",body:g});if(V.status===413)throw new Error("GIF檔案過大，請自行下載後上傳至其他圖床");return await V.text()}async function S(){if(!v.value)return;s.value=!0;const b=new ClipboardItem({"text/plain":(async()=>{try{if(h.value)return new Blob([h.value],{type:"text/plain"});p.value="正在上傳GIF...",f.value=!0;const g=await k();return h.value=g,new Blob([g],{type:"text/plain"})}catch(g){throw p.value=g instanceof Error?g.message:"GIF 上傳失敗",E(g),g}})()});try{await navigator.clipboard.write([b]),p.value="GIF 連結複製成功"}catch(g){g instanceof Error&&g.name==="NotAllowedError"?p.value="GIF 連結複製失敗":p.value=g instanceof Error?g.message:"GIF 上傳失敗",E(g)}finally{f.value=!0,s.value=!1}}async function O(){if(i.value)return;if(v.value){m.value=!0;return}h.value=null,i.value=!0,p.value="GIF生成中...",f.value=!0;const b=performance.now(),g=Array.from({length:u.frameEnd-u.frameStart-4},(V,F)=>u.frameStart+F+2);try{await d();const V=g.map(async re=>{const Ue=`${_t}${u.season}/${u.episode}/${re}.webp`,Ve=await tt(Ue);await e.writeFile(`${re}.webp`,Ve)});await Promise.all(V),await e.exec(["-start_number",g[0].toString(),"-i","%d.webp","-vf","palettegen","palette.png"]),await e.exec(["-start_number",g[0].toString(),"-i","%d.webp","-i","palette.png","-filter_complex","paletteuse=dither=none","-frames:v",g.length.toString(),"-f","gif","-framerate","24","output.gif"]);const F=await e.readFile("output.gif");v.value=new Blob([F],{type:"image/gif"}),l.value=URL.createObjectURL(v.value);const Ie=((performance.now()-b)/1e3).toFixed(1);p.value=`GIF生成完成 (${Ie}秒)`,m.value=!0}catch(V){console.error("GIF generation failed:",V),E(V),p.value="GIF生成失敗"}finally{i.value=!1,f.value=!0;const V=g.map(F=>e.deleteFile(`${F}.webp`).catch(console.error));await Promise.all([...V,e.deleteFile("output.gif").catch(console.error),e.deleteFile("palette.png").catch(console.error)])}}async function E(b){const g={content:`Copy failed: ${b.name}

${navigator.userAgent}

${b.message}

${b.stack}`};try{await fetch(`https://discord.com/api/webhooks/${atob(Q.webhook)}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})}catch(V){console.error("Failed to send error report to Discord:",V)}}return t({CreateGif:O,isGeneratingGif:i}),(b,g)=>(C(),T(W,null,[n(N,{modelValue:m.value,"onUpdate:modelValue":g[0]||(g[0]=V=>m.value=V),"max-width":"600px",style:{maxHeight:"90vh"}},{default:r(()=>[n(L,null,{default:r(()=>[n(ve,{src:l.value,style:{maxHeight:"70vh",objectFit:"contain"}},null,8,["src"]),n(Z,null,{default:r(()=>[n(B,null,{default:r(()=>[n($,{onClick:U,loading:c.value},{default:r(()=>g[2]||(g[2]=[I("下載")])),_:1},8,["loading"]),n($,{onClick:S,loading:s.value},{default:r(()=>g[3]||(g[3]=[I("生成連結")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(oe,{modelValue:f.value,"onUpdate:modelValue":g[1]||(g[1]=V=>f.value=V),timeout:2e3,class:"text-center",rounded:"pill"},{default:r(()=>[x("div",$t,A(p.value),1)]),_:1},8,["modelValue"])],64))}}),Ft=M({__name:"index",props:{styles:{type:Object,required:!0},cardData:{type:Object,required:!0},videoConfig:{type:Object,required:!0},webhookUrl:{type:String,required:!0},baseImageUrl:{type:String,default:"https://mypic.0m0.uk/images/"}},setup(a){const t=a,e=y(!1),o=y(null),u=_(()=>Se(t.baseImageUrl,t.cardData.season,t.cardData.episode,t.cardData.frame.prefer)),m=()=>{},f=async()=>{o.value&&await o.value.CreateGif()};return(p,i)=>{var c;return C(),T("div",{style:fe(a.styles)},[n(ht,{"card-data":a.cardData,"base-image-url":a.baseImageUrl,onClick:i[0]||(i[0]=s=>e.value=!0)},null,8,["card-data","base-image-url"]),n(Dt,{show:e.value,"onUpdate:show":i[1]||(i[1]=s=>e.value=s),"card-data":a.cardData,"webhook-url":a.webhookUrl,"image-url":u.value,"video-config":a.videoConfig,onReport:m,onGifCreate:f,"is-gif-creating":(c=o.value)==null?void 0:c.isGeneratingGif},{"report-dialog":r(()=>[n(xe,{"file-name":u.value,text:a.cardData.text},null,8,["file-name","text"])]),_:1},8,["show","card-data","webhook-url","image-url","video-config","is-gif-creating"]),n(Mt,{ref_key:"gifDialogRef",ref:o,text:a.cardData.text,season:a.cardData.season,episode:a.cardData.episode,"frame-start":a.cardData.frame.start,"frame-end":a.cardData.frame.end},null,8,["text","season","episode","frame-start","frame-end"])],4)}}}),Rt=M({__name:"ResultGrid",setup(a){const t=rt(),e=q(),{filteredCards:o}=et(t),u=_(()=>`https://discord.com/api/webhooks/${atob(Q.webhook)}`);let m=y(24);const f=()=>{m.value=(1+Math.floor((window.innerWidth-320)/310))*8},p=_(()=>{typeof window<"u"&&window.scrollTo({top:0,left:0,behavior:"smooth"});const c=o.value;return e.isReversed,(s,l)=>{const v=c.slice(s*l,(s+1)*l);return Promise.resolve(v)}}),i=c=>{var s=c.value;return s==null?void 0:s.segmentId};return H(()=>{f(),window.addEventListener("resize",f)}),me(()=>{window.removeEventListener("resize",f)}),(c,s)=>(C(),D(Re,null,{default:r(()=>[n(w(ot),{length:w(o).length?w(o).length:1,pageSize:w(m),pageProvider:p.value,"get-key":i,"page-provider-debounce-time":100,class:"grid ma-5"},{placeholder:r(({index:l,style:v})=>[x("div",{class:"item",style:fe(v)},A(w(o).length?"還在GO...":""),5)]),default:r(({item:l,style:v,index:h})=>[n(Ft,{styles:v,"card-data":l,"video-config":w(Q).videoLink,"webhook-url":u.value},null,8,["styles","card-data","video-config","webhook-url"])]),_:1},8,["length","pageSize","pageProvider"])]),fallback:r(()=>s[0]||(s[0]=[x("p",null,"Loading...",-1)])),_:1}))}}),At=ne(Rt,[["__scopeId","data-v-fde939d1"]]),ce=M({__name:"MultiSelect",props:Ae({items:{type:Array,required:!0},label:{type:String,required:!1,default:"Select"}},{modelValue:{type:Array,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const t=a,e=Ee(a,"modelValue"),o=_(()=>e.value.length===t.items.length),u=_(()=>e.value.length>0&&e.value.length<t.items.length),m=()=>{o.value?e.value=[]:e.value=[...t.items]};return de(e,()=>{e.value.sort()}),(f,p)=>(C(),D(qe,{modelValue:e.value,"onUpdate:modelValue":p[0]||(p[0]=i=>e.value=i),label:a.label,variant:"outlined",multiple:"",items:a.items,style:{"min-width":"250px"}},{"prepend-item":r(()=>[n(P,{title:"全選",onClick:m},{prepend:r(()=>[n(Ne,{indeterminate:u.value,"model-value":o.value},null,8,["indeterminate","model-value"])]),_:1}),n(Be,{class:"mt-2"})]),selection:r(({item:i,index:c})=>[e.value.length!=a.items.length?(C(),D(se,{key:0},{default:r(()=>[x("span",null,A(i.value),1)]),_:2},1024)):ee("",!0),c===a.items.length-1?(C(),D(se,{key:1},{default:r(()=>p[1]||(p[1]=[x("span",null,"全選",-1)])),_:1})):ee("",!0)]),_:1},8,["modelValue","label","items"]))}}),Et=M({__name:"FilterDialog",setup(a){const t=we(),e=y(!1),o=y([]),u=y([]),m=y([]),f=()=>{u.value=[],m.value=[],o.value=[]},p=()=>{t.mygoEpisodes=u.value,t.avemujicaEpisodes=m.value,t.characterId=0,e.value=!1};return H(()=>{u.value=t.mygoEpisodes,m.value=t.avemujicaEpisodes}),(i,c)=>(C(),D(N,{modelValue:e.value,"onUpdate:modelValue":c[2]||(c[2]=s=>e.value=s),"max-width":"600px",style:{"min-height":"600px"},transition:"dialog-top-transition"},{activator:r(({props:s})=>[n(Y,Oe(s,{icon:w(Je)}),null,16,["icon"])]),default:r(()=>[n(L,{class:"d-flex flex-column align-center justify-center font-weight-bold"},{default:r(()=>[c[3]||(c[3]=x("br",null,null,-1)),c[4]||(c[4]=x("br",null,null,-1)),c[5]||(c[5]=x("span",{class:"align-center"},"集數篩選",-1)),n(ce,{items:w(ue)[w(R).MYGO],modelValue:u.value,"onUpdate:modelValue":c[0]||(c[0]=s=>u.value=s),label:"MyGO",style:{"min-width":"250px"}},null,8,["items","modelValue"]),n(ce,{items:w(ue)[w(R).AVE_MUJICA],modelValue:m.value,"onUpdate:modelValue":c[1]||(c[1]=s=>m.value=s),label:"Ave Mujica",style:{"min-width":"250px"}},null,8,["items","modelValue"]),n(Z,null,{default:r(()=>[n($,{class:"text-center",text:"清除篩選",onClick:f}),n($,{class:"text-center",text:"確定",onClick:p})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ot=M({__name:"AppBarComponent",setup(a){const t=q(),e=ye(),o=y(""),u=Xe(()=>{e.query=o.value},500),m=()=>{e.query=o.value},f=()=>{o.value="",e.query=""};return H(()=>{const i=new URLSearchParams(window.location.search).get("q");i&&(o.value=i,e.query=i)}),(p,i)=>{const c=Et;return C(),D(Ye,{density:"prominent"},{default:r(()=>[n(ge,null,{default:r(()=>[i[1]||(i[1]=x("div",{class:"text-h5 mx-auto font-weight-bold text-center text-truncate"}," MyGO Mujica 截圖搜尋器 ",-1)),n(B,{dense:"",class:"mt-2"},{default:r(()=>[n(j,{class:"text-center"},{default:r(()=>[n(te,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=s=>o.value=s),"single-line":"","hide-details":"",clearable:"",label:"搜尋",variant:"outlined",class:"short-search",onKeyup:Te(m,["enter"]),"onClick:clear":f,onInput:w(u),autofocus:""},{append:r(()=>[n(Y,{onClick:w(t).toggleReverse,icon:w(t).isReversed?w(Qe):w(We)},null,8,["onClick","icon"])]),"append-inner":r(()=>[n(c)]),_:1},8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),ea=M({__name:"index",setup(a){return(t,e)=>{const o=Ot,u=At,m=ut;return C(),T(W,null,[n(o),n(u),n(m,{style:{width:"100%"}})],64)}}});export{ea as default};
